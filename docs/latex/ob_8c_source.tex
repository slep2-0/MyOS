\doxysection{ob.\+c}
\hypertarget{ob_8c_source}{}\label{ob_8c_source}\index{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/ob/ob.c@{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/ob/ob.c}}
\mbox{\hyperlink{ob_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00001}00001\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00002}00002\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00003}00003\ \textcolor{comment}{Module\ Name:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00004}00004\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00005}00005\ \textcolor{comment}{\ \ \ \ ob.c}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00006}00006\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00007}00007\ \textcolor{comment}{Purpose:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00008}00008\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00009}00009\ \textcolor{comment}{\ \ \ \ This\ translation\ unit\ contains\ the\ implementation\ of\ the\ object\ manager.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00010}00010\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00011}00011\ \textcolor{comment}{Author:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00012}00012\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00013}00013\ \textcolor{comment}{\ \ \ \ slep\ (Matanel)\ 2025.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00014}00014\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00015}00015\ \textcolor{comment}{Revision\ History:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00016}00016\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00017}00017\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00019}00019\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ob_8h}{../../includes/ob.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00020}00020\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mg_8h}{../../includes/mg.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00021}00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{md_8h}{../../includes/md.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00022}00022\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{assert_8h}{../../assert.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00023}00023\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ps_8h}{../../includes/ps.h}}"{}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00025}00025\ \textcolor{comment}{//\ Global\ list\ of\ types\ (for\ debugging/enumeration)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00026}\mbox{\hyperlink{ob_8c_afc64c0ecc5d40b1eef2e0e6fbc8abc81}{00026}}\ \mbox{\hyperlink{core_8h_afb9223ccda4ca489763aad6961a26c65}{DOUBLY\_LINKED\_LIST}}\ \mbox{\hyperlink{ob_8c_afc64c0ecc5d40b1eef2e0e6fbc8abc81}{ObTypeDirectoryList}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00027}\mbox{\hyperlink{ob_8c_aa1aefb6b9f4fd893e3ea448d19834c73}{00027}}\ \mbox{\hyperlink{ms_8h_adf17fb77fea5ef3f703733414efda5c4}{SPINLOCK}}\ \mbox{\hyperlink{ob_8c_aa1aefb6b9f4fd893e3ea448d19834c73}{ObGlobalLock}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00028}\mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{00028}}\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{ObpReaperList}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00029}00029\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00031}\mbox{\hyperlink{ob_8c_a97ac199eae2eba0160eeda6409fb6838}{00031}}\ \mbox{\hyperlink{me_8h_ab4a5c3c2096f05e5f0db35f80685b4a2}{DPC}}\ \mbox{\hyperlink{ob_8c_a97ac199eae2eba0160eeda6409fb6838}{ObpReaperDpc}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00032}00032\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00033}\mbox{\hyperlink{ob_8c_a09d0cedd77eee1c5d29fd57db0e00eaf}{00033}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{ob_8c_a09d0cedd77eee1c5d29fd57db0e00eaf}{ObInitialize}}\ (}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00034}00034\ \ \ \ \ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00035}00035\ )\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00037}00037\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00038}00038\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00039}00039\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00040}00040\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00041}00041\ \textcolor{comment}{\ \ \ \ \ \ \ \ Initializes\ the\ Object\ Manager\ of\ the\ kernel.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00042}00042\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00043}00043\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00044}00044\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00045}00045\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00046}00046\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00047}00047\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00048}00048\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00049}00049\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00050}00050\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00051}00051\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00053}00053\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00054}00054\ \ \ \ \ \mbox{\hyperlink{ob_8c_aa1aefb6b9f4fd893e3ea448d19834c73}{ObGlobalLock}}.locked\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00055}00055\ \ \ \ \ \mbox{\hyperlink{ms_8h_a46e3ce34dec4da38189211cef81110c1}{InitializeListHead}}(\&\mbox{\hyperlink{ob_8c_afc64c0ecc5d40b1eef2e0e6fbc8abc81}{ObTypeDirectoryList}});}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00056}00056\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ DPC\ here,\ not\ at\ the\ ObpDefer\ function,\ as\ it\ would\ overwrite.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00057}00057\ \ \ \ \ \mbox{\hyperlink{dpc_8c_a9f616b46e03e4d75165b5e334582fe2f}{MeInitializeDpc}}(\&\mbox{\hyperlink{ob_8c_a97ac199eae2eba0160eeda6409fb6838}{ObpReaperDpc}},\ \mbox{\hyperlink{dpc_8c_abdd0a726135e1e29003297d864243ebc}{ReapOb}},\ NULL,\ \mbox{\hyperlink{me_8h_ab43279866db2c797f7ec886b4ac344d6a06b314d863076d54942e065d90c179c4}{MEDIUM\_PRIORITY}});}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00058}00058\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00060}\mbox{\hyperlink{ob_8c_a7699b9d8a8391091c460b476b66e457c}{00060}}\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}\ \mbox{\hyperlink{ob_8c_a7699b9d8a8391091c460b476b66e457c}{ObCreateObjectType}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00061}00061\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{char}*\ TypeName,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00062}00062\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ob_8h_a227fc515e97c89f7dfd05ed812947c46}{POBJECT\_TYPE\_INITIALIZER}}\ ObjectTypeInitializer,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00063}00063\ \ \ \ \ \mbox{\hyperlink{annotations_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}\ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}*\ ReturnedObjectType}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00064}00064\ )\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00066}00066\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00067}00067\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00068}00068\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00069}00069\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00070}00070\ \textcolor{comment}{\ \ \ \ \ \ \ \ Creates\ an\ object\ type\ for\ the\ specified\ object\ in\ the\ kernel\ subsystem.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00071}00071\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00072}00072\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00073}00073\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00074}00074\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ char*\ TypeName\ -\/\ The\ name\ of\ the\ object\ subsystem\ that\ will\ be\ created\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00075}00075\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ POBJECT\_TYPE\_INITIALIZER\ ObjectTypeInitializer\ -\/\ The\ initializer\ for\ each\ object\ created\ by\ ObCreateObject\ that\ defines\ how\ it\ should\ be\ created\ \&\ its\ attributes.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00076}00076\ \textcolor{comment}{\ \ \ \ \ \ \ \ [OUT]\ \ \ POBJECT\_TYPE*\ ReturnedObjectType\ -\/\ The\ returned\ object\ type,\ used\ to\ identify\ this\ type\ of\ object\ initialization.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00077}00077\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00078}00078\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00079}00079\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00080}00080\ \textcolor{comment}{\ \ \ \ \ \ \ \ MTSTATUS\ Status\ codes:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00081}00081\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00082}00082\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_INVALID\_PARAM:\ Invalid\ parameter,\ one\ of\ them\ is\ NULL.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00083}00083\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_NO\_MEMORY:\ No\ memory\ is\ available\ to\ create\ the\ object\ type.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00084}00084\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_SUCCESS:\ Successfully\ created\ the\ object\ type.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00085}00085\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00086}00086\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00087}00087\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00088}00088\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00089}00089\ \ \ \ \ \textcolor{keywordflow}{if}\ (!TypeName\ ||\ !ObjectTypeInitializer\ ||\ !ReturnedObjectType)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00090}00090\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00091}00091\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00092}00092\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00093}00093\ \ \ \ \ \textcolor{comment}{//\ Allocate\ the\ Type\ Object\ itself.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00094}00094\ \ \ \ \ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}\ NewType\ =\ (\mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}})\mbox{\hyperlink{pool_8c_ae9d292b2b45846858ec19cb240e2c2d1}{MmAllocatePoolWithTag}}(\mbox{\hyperlink{mm_8h_a32a1467b2542bf2a6384f6fc19953bddab404d073a115ee062dbc5f16be851ea7}{NonPagedPool}},\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{ob_8h_aa6a56ab1cd79c48801dfcc39dfedf89f}{OBJECT\_TYPE}}),\ \textcolor{stringliteral}{'epyT'});\ \textcolor{comment}{//\ Type}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{if}\ (!NewType)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a04d00d9b51e2f25c23b87d750df59dc4}{MT\_NO\_MEMORY}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00097}00097\ \ \ \ \ \textcolor{comment}{//\ Initialize\ the\ Type\ Object}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00098}00098\ \ \ \ \ \mbox{\hyperlink{mm_8h_a7d9455da4f2ec94a98286a19e7d8e39d}{kmemset}}(NewType,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{ob_8h_aa6a56ab1cd79c48801dfcc39dfedf89f}{OBJECT\_TYPE}}));}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00099}00099\ \ \ \ \ \mbox{\hyperlink{gop_8c_a928767eb3d6af2e725d8be0b32bd4582}{kstrncpy}}(NewType-\/>\mbox{\hyperlink{struct___o_b_j_e_c_t___t_y_p_e_af6eacd95aeffd085cd09b2aa1c284ff2}{Name}},\ TypeName,\ 32);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00101}00101\ \ \ \ \ \textcolor{comment}{//\ Copy\ the\ initializer\ into\ the\ object}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00102}00102\ \ \ \ \ \mbox{\hyperlink{mm_8h_a6630c639a0df46de61c0bcde4097890d}{kmemcpy}}(\&NewType-\/>\mbox{\hyperlink{struct___o_b_j_e_c_t___t_y_p_e_afc5d188d48c8561fb08d29c3781ff070}{TypeInfo}},\ ObjectTypeInitializer,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{ob_8h_aca5fc29c63c18f0b96962634374d206c}{OBJECT\_TYPE\_INITIALIZER}}));}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00104}00104\ \ \ \ \ \textcolor{comment}{//\ Link\ it\ into\ the\ global\ list}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00105}00105\ \ \ \ \ \mbox{\hyperlink{core_8h_a7258ea91cea6c1c174df48f6225ef4da}{IRQL}}\ oldIrql;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00106}00106\ \ \ \ \ \mbox{\hyperlink{spinlock_8c_a1efc92e3aa7c8ab17da8a844bb9fd129}{MsAcquireSpinlock}}(\&\mbox{\hyperlink{ob_8c_aa1aefb6b9f4fd893e3ea448d19834c73}{ObGlobalLock}},\ \&oldIrql);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00107}00107\ \ \ \ \ \mbox{\hyperlink{ms_8h_abc60fab3d33ed1b1c9f11d1ed674a7b3}{InsertTailList}}(\&\mbox{\hyperlink{ob_8c_afc64c0ecc5d40b1eef2e0e6fbc8abc81}{ObTypeDirectoryList}},\ \&NewType-\/>\mbox{\hyperlink{struct___o_b_j_e_c_t___t_y_p_e_ac7387d333c87619acb612df56567e8a1}{TypeList}});}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00108}00108\ \ \ \ \ \mbox{\hyperlink{spinlock_8c_ac938b07a766c2e0f5c701f2264e46918}{MsReleaseSpinlock}}(\&\mbox{\hyperlink{ob_8c_aa1aefb6b9f4fd893e3ea448d19834c73}{ObGlobalLock}},\ oldIrql);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00110}00110\ \ \ \ \ \textcolor{comment}{//\ 5.\ Return\ the\ pointer}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00111}00111\ \ \ \ \ *ReturnedObjectType\ =\ NewType;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00112}00112\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00113}00113\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00114}00114\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00115}00115\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00116}\mbox{\hyperlink{ob_8c_ad77278de8f30feb544f7bd27bd85a81f}{00116}}\ \mbox{\hyperlink{ob_8c_ad77278de8f30feb544f7bd27bd85a81f}{ObCreateObject}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00117}00117\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}\ ObjectType,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00118}00118\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ uint32\_t\ ObjectSize,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00119}00119\ \ \ \ \ \mbox{\hyperlink{annotations_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}\ \textcolor{keywordtype}{void}**\ ObjectCreated}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00120}00120\ \ \ \ \ \textcolor{comment}{//\_In\_Opt\ char*\ Name\ -\/\ When\ files\ arrive,\ i'll\ uncomment\ this.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00121}00121\ )\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00122}00122\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00123}00123\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00124}00124\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00125}00125\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00126}00126\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00127}00127\ \textcolor{comment}{\ \ \ \ \ \ \ Creates\ an\ object\ for\ the\ specified\ object\ type\ subsystem.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00128}00128\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00129}00129\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00130}00130\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00131}00131\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ POBJECT\_TYPE\ ObjectType\ -\/\ The\ object\ type\ to\ create\ the\ object\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00132}00132\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ uint32\_t\ ObjectBodySize\ -\/\ The\ size\ of\ the\ object\ in\ bytes\ to\ create.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00133}00133\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00134}00134\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00135}00135\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00136}00136\ \textcolor{comment}{\ \ \ \ \ \ \ \ Pointer\ to\ object,\ or\ NULL\ on\ failure.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00137}00137\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00138}00138\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00140}00140\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00141}00141\ \ \ \ \ \textcolor{comment}{//\ 1.\ Calculate\ size}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00142}00142\ \ \ \ \ \textcolor{keywordtype}{size\_t}\ ActualSize\ =\ \textcolor{keyword}{sizeof}(OBJECT\_HEADER)\ +\ ObjectSize;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00143}00143\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00144}00144\ \ \ \ \ \textcolor{comment}{//\ Allocate\ memory\ for\ the\ header.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00145}00145\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header\ =\ (\mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}})\mbox{\hyperlink{pool_8c_ae9d292b2b45846858ec19cb240e2c2d1}{MmAllocatePoolWithTag}}(ObjectType-\/>TypeInfo.PoolType,\ ActualSize,\ \textcolor{stringliteral}{'bObO'});\ \textcolor{comment}{//\ Ob\ Object,\ not\ bobo,\ lol.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00146}00146\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Header)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a04d00d9b51e2f25c23b87d750df59dc4}{MT\_NO\_MEMORY}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00148}00148\ \ \ \ \ Header-\/>Type\ =\ ObjectType;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00149}00149\ \ \ \ \ Header-\/>PointerCount\ =\ 1;\ \textcolor{comment}{//\ Start\ with\ 1\ reference}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00150}00150\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00151}00151\ \ \ \ \ \textcolor{comment}{//\ Update\ stats\ in\ the\ Type\ object}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00152}00152\ \ \ \ \ \mbox{\hyperlink{atomic_8h_a27cd82fe2beb9519f805e93551e2aa4b}{InterlockedIncrementU32}}((\textcolor{keyword}{volatile}\ uint32\_t*)\&ObjectType-\/>TotalNumberOfObjects);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00154}00154\ \ \ \ \ \textcolor{comment}{//\ Return\ Body}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00155}00155\ \ \ \ \ *ObjectCreated\ =\ \mbox{\hyperlink{ob_8h_a3a81b69fccafefd4b0478661ecd69106}{OBJECT\_HEADER\_TO\_OBJECT}}(Header);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00156}00156\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00157}00157\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00159}00159\ \textcolor{keywordtype}{bool}\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00160}\mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{00160}}\ \mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{ObReferenceObject}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00161}00161\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \ \textcolor{keywordtype}{void}*\ Object}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00162}00162\ )\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00163}00163\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00164}00164\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00165}00165\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00166}00166\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00167}00167\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00168}00168\ \textcolor{comment}{\ \ \ \ \ \ \ References\ the\ Object\ given.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00169}00169\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00170}00170\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00171}00171\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00172}00172\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ Object\ -\/\ The\ Object\ to\ increment\ reference\ count\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00173}00173\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00174}00174\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00175}00175\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00176}00176\ \textcolor{comment}{\ \ \ \ \ \ \ \ True\ if\ reference\ succeded,\ false\ otherwise\ (object\ dying/dead).}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00177}00177\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00178}00178\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00180}00180\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00181}00181\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Object)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00182}00182\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header\ =\ \mbox{\hyperlink{ob_8h_acd993b46cb8205b25d9cc1f9c6959a59}{OBJECT\_TO\_OBJECT\_HEADER}}(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00184}00184\ \ \ \ \ uint64\_t\ OldCount\ =\ Header-\/>PointerCount;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00185}00185\ \ \ \ \ \textcolor{keywordflow}{while}\ (1)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00186}00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (OldCount\ ==\ 0)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{false};\ \textcolor{comment}{//\ Object\ is\ dying\ or\ dead}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00187}00187\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00188}00188\ \ \ \ \ \ \ \ \ uint64\_t\ NewCount\ =\ \mbox{\hyperlink{atomic_8h_a39d94e872c7402bfe84a8dc0d107b865}{InterlockedCompareExchangeU64}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00189}00189\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keyword}{volatile}\ uint64\_t*)\&Header-\/>PointerCount,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00190}00190\ \ \ \ \ \ \ \ \ \ \ \ \ OldCount\ +\ 1,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00191}00191\ \ \ \ \ \ \ \ \ \ \ \ \ OldCount}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00192}00192\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00194}00194\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (NewCount\ ==\ OldCount)\ \textcolor{keywordflow}{return}\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00195}00195\ \ \ \ \ \ \ \ \ OldCount\ =\ NewCount;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00196}00196\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00197}00197\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00198}00198\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00199}00199\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00200}\mbox{\hyperlink{ob_8c_a6060934b4b8c0fd9bc4b7fc089578835}{00200}}\ \mbox{\hyperlink{ob_8c_a6060934b4b8c0fd9bc4b7fc089578835}{ObReferenceObjectByPointer}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00201}00201\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \ \textcolor{keywordtype}{void}*\ Object,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00202}00202\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}\ DesiredType}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00203}00203\ )}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00204}00204\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00205}00205\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00206}00206\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00207}00207\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00208}00208\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00209}00209\ \textcolor{comment}{\ \ \ \ \ \ \ References\ the\ Object\ given\ by\ its\ pointer.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00210}00210\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00211}00211\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00212}00212\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00213}00213\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ Object\ -\/\ The\ Object\ to\ increment\ reference\ count\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00214}00214\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ POBJECT\_TYPE\ DesiredType\ -\/\ The\ type\ we\ EXPECT\ the\ Object\ to\ be\ (PsProcessType,\ PsThreadType,\ etc..)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00215}00215\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00216}00216\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00217}00217\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00218}00218\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_SUCCESS\ if\ reference\ succeeded.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00219}00219\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_TYPE\_MISMATCH\ if\ DesiredType\ isn't\ the\ Object's\ actual\ OBJECT\_TYPE.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00220}00220\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_INVALID\_PARAM\ if\ Object\ is\ NULL.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00221}00221\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_OBJECT\_DELETED\ if\ Object\ is\ deleted\ /\ ongoing\ deletion.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00222}00222\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00223}00223\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_BETTER\_THAN\_WINDOWS\ if\ (true)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00224}00224\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00225}00225\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00226}00226\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00227}00227\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00228}00228\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Object)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00230}00230\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header\ =\ \mbox{\hyperlink{ob_8h_acd993b46cb8205b25d9cc1f9c6959a59}{OBJECT\_TO\_OBJECT\_HEADER}}(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00231}00231\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00232}00232\ \ \ \ \ \textcolor{comment}{//\ If\ the\ caller\ expects\ a\ process\ but\ gets\ a\ thread\ or\ a\ file,\ we\ say\ no\ no\ bye\ bye.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00233}00233\ \ \ \ \ \textcolor{keywordflow}{if}\ (DesiredType\ !=\ NULL\ \&\&\ Header-\/>Type\ !=\ DesiredType)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00234}00234\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a06b2ea35dc4950e1cfc5230fec808e6c}{MT\_TYPE\_MISMATCH}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00235}00235\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00236}00236\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00237}00237\ \ \ \ \ \textcolor{comment}{//\ We\ reference\ it.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00238}00238\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{ObReferenceObject}}(Object))\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00239}00239\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00240}00240\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00241}00241\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00242}00242\ \ \ \ \ \textcolor{comment}{//\ Object\ is\ RIP,\ we\ return.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00243}00243\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a5b539ecb91c4b8622d9566a08b710d1f}{MT\_OBJECT\_DELETED}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00244}00244\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00246}00246\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00247}\mbox{\hyperlink{ob_8c_a47671180c09015ad53f4b1dbacd09de6}{00247}}\ \mbox{\hyperlink{ob_8c_a47671180c09015ad53f4b1dbacd09de6}{ObReferenceObjectByHandle}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00248}00248\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ht_8h_a84a85b4c81f3ad61278cc4473a44f202}{HANDLE}}\ Handle,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00249}00249\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ uint32\_t\ DesiredAccess,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00250}00250\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}\ DesiredType,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00251}00251\ \ \ \ \ \mbox{\hyperlink{annotations_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}\ \textcolor{keywordtype}{void}**\ Object,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00252}00252\ \ \ \ \ \mbox{\hyperlink{annotations_8h_a847bfbc4921fd3f7c84381c60a6a1b90}{\_Out\_Opt}}\ \mbox{\hyperlink{ht_8h_a555fe8af7cfd68bcf804156fc8b3777a}{PHANDLE\_TABLE\_ENTRY}}\ HandleInformation}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00253}00253\ )}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00254}00254\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00255}00255\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00256}00256\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00257}00257\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00258}00258\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00259}00259\ \textcolor{comment}{\ \ \ \ \ \ \ References\ the\ Object\ given\ by\ its\ given\ handle.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00260}00260\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00261}00261\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00262}00262\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00263}00263\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ HANDLE\ Handle\ -\/\ The\ handle\ to\ reference\ the\ object\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00264}00264\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ uint32\_t\ DesiredAccess\ -\/\ The\ access\ rights\ requested\ for\ the\ object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00265}00265\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ POBJECT\_TYPE\ DesiredType\ -\/\ The\ type\ we\ EXPECT\ the\ Object\ to\ be\ (PsProcessType,\ PsThreadType,\ etc..)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00266}00266\ \textcolor{comment}{\ \ \ \ \ \ \ \ [OUT]\ \ \ void**\ Object\ -\/\ The\ pointer\ to\ the\ object\ expected.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00267}00267\ \textcolor{comment}{\ \ \ \ \ \ \ \ [OUT\ OPTIONAL]\ \ PHANDLE\_TABLE\_ENTRY\ HandleInformation\ -\/\ Information\ about\ the\ handle\ given\ if\ MT\_SUCCESS\ is\ returned.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00268}00268\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00269}00269\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00270}00270\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00271}00271\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_SUCCESS\ if\ reference\ succeeded.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00272}00272\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_INVALID\_HANDLE\ if\ the\ HANDLE\ is\ simply\ invalid\ (doesn't\ exist,\ or\ table\ doesnt\ exist)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00273}00273\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_TYPE\_MISMATCH\ if\ DesiredType\ isn't\ the\ Object's\ actual\ OBJECT\_TYPE.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00274}00274\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_INVALID\_PARAM\ if\ Object\ is\ NULL.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00275}00275\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_OBJECT\_DELETED\ if\ Object\ is\ deleted\ /\ ongoing\ deletion.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00276}00276\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_ACCESS\_DENIED\ if\ the\ desired\ access\ does\ not\ meet\ the\ access\ rights\ of\ the\ Object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00277}00277\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00278}00278\ \textcolor{comment}{\ \ \ \ \ \ \ \ MT\_BETTER\_THAN\_WINDOWS\ if\ (true)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00279}00279\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00280}00280\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00281}00281\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00282}00282\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00283}00283\ \ \ \ \ \textcolor{comment}{//\ Set\ initially\ to\ NULL.\ (to\ overwrite\ stack\ default\ if\ uninitialized)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00284}00284\ \ \ \ \ *Object\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00285}00285\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00286}00286\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ handle\ table\ from\ current\ process\ (requesting\ process)}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00287}00287\ \ \ \ \ \mbox{\hyperlink{core_8h_a991a69d592c53aaa098317abccbdfca7}{PEPROCESS}}\ Process\ =\ \mbox{\hyperlink{ps_8h_a1ad0a15fe3e79d2fd18f00bd361d1eef}{PsGetCurrentProcess}}();}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00288}00288\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Process\ ||\ !Process-\/>\mbox{\hyperlink{struct___e_p_r_o_c_e_s_s_a433fb021c56e2c0fdbdec96ea9dcecab}{ObjectTable}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_aa7188fae8aa0195501b03f629a441554}{MT\_INVALID\_HANDLE}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00289}00289\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00290}00290\ \ \ \ \ \textcolor{comment}{//\ Lookup\ in\ the\ handle\ table.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00291}00291\ \ \ \ \ \mbox{\hyperlink{ht_8h_a555fe8af7cfd68bcf804156fc8b3777a}{PHANDLE\_TABLE\_ENTRY}}\ OutHandleEntry\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00292}00292\ \ \ \ \ \textcolor{keywordtype}{void}*\ RetrievedObject\ =\ \mbox{\hyperlink{handle_8c_a3ab925bc21d946c96d3656b6e9662a43}{HtGetObject}}(Process-\/>\mbox{\hyperlink{struct___e_p_r_o_c_e_s_s_a433fb021c56e2c0fdbdec96ea9dcecab}{ObjectTable}},\ Handle,\ \&OutHandleEntry);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00293}00293\ \ \ \ \ \textcolor{keywordflow}{if}\ (!RetrievedObject)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_aa7188fae8aa0195501b03f629a441554}{MT\_INVALID\_HANDLE}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00294}00294\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00295}00295\ \ \ \ \ \textcolor{comment}{//\ Get\ the\ header.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00296}00296\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header\ =\ \mbox{\hyperlink{ob_8h_acd993b46cb8205b25d9cc1f9c6959a59}{OBJECT\_TO\_OBJECT\_HEADER}}(RetrievedObject);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00297}00297\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00298}00298\ \ \ \ \ \textcolor{comment}{//\ Lets\ check\ if\ the\ type\ matches}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00299}00299\ \ \ \ \ \textcolor{keywordflow}{if}\ (DesiredType\ \&\&\ Header-\/>Type\ !=\ DesiredType)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00300}00300\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Invalid\ type.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00301}00301\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a06b2ea35dc4950e1cfc5230fec808e6c}{MT\_TYPE\_MISMATCH}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00302}00302\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00303}00303\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00304}00304\ \ \ \ \ \textcolor{comment}{//\ Check\ access.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00305}00305\ \ \ \ \ \textcolor{keywordflow}{if}\ ((OutHandleEntry-\/>\mbox{\hyperlink{struct___h_a_n_d_l_e___t_a_b_l_e___e_n_t_r_y_ae25d75c11a8d76a94750c956e9ba0621}{GrantedAccess}}\ \&\ DesiredAccess)\ !=\ DesiredAccess)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00306}00306\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Access\ is\ invalid.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00307}00307\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a26f01ccb752ead3aa3dd4c44fbc552b7}{MT\_ACCESS\_DENIED}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00308}00308\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00309}00309\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00310}00310\ \ \ \ \ \textcolor{comment}{//\ Wow!!\ It\ is\ all\ good!!,\ reference\ it.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00311}00311\ \ \ \ \ \mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{ObReferenceObject}}(RetrievedObject);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00312}00312\ \ \ \ \ *Object\ =\ RetrievedObject;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00313}00313\ \ \ \ \ \textcolor{keywordflow}{if}\ (HandleInformation)\ *HandleInformation\ =\ *OutHandleEntry;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00314}00314\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00315}00315\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00317}00317\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00318}\mbox{\hyperlink{ob_8c_a04672b5205937df681888794716e3a2c}{00318}}\ \mbox{\hyperlink{ob_8c_a04672b5205937df681888794716e3a2c}{ObCreateHandleForObject}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00319}00319\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{void}*\ Object,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00320}00320\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ht_8h_a18b1b4f2fb3e795e24fd8eddc2b48c08}{ACCESS\_MASK}}\ DesiredAccess,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00321}00321\ \ \ \ \ \mbox{\hyperlink{annotations_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}\ \mbox{\hyperlink{ht_8h_a4eff5701246ce814577877fc805928de}{PHANDLE}}\ ReturnedHandle}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00322}00322\ )}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00323}00323\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00324}00324\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00325}00325\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00326}00326\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00327}00327\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00328}00328\ \textcolor{comment}{\ \ \ \ \ \ \ Creates\ a\ handle\ in\ the\ current\ process's\ handle\ table\ for\ the\ specified\ Object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00329}00329\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00330}00330\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00331}00331\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00332}00332\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ Object\ -\/\ The\ object\ to\ create\ the\ handle\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00333}00333\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ ACCESS\_MASK\ DesiredAccess\ -\/\ The\ maximum\ access\ the\ handle\ should\ have.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00334}00334\ \textcolor{comment}{\ \ \ \ \ \ \ \ [OUT]\ \ \ PHANDLE\ ReturnedHandle\ -\/\ The\ returned\ handle\ for\ the\ object\ if\ success.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00335}00335\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00336}00336\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00337}00337\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00338}00338\ \textcolor{comment}{\ \ \ \ \ \ \ \ MTSTATUS\ Status\ Codes:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00339}00339\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00340}00340\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_SUCCESS\ -\/\ Successful.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00341}00341\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_INVALID\_STATE\ -\/\ No\ handle\ table\ for\ current\ process.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00342}00342\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_INVALID\_CHECK\ -\/\ HtCreateHandle\ returned\ MT\_INVALID\_HANDLE.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00343}00343\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00345}00345\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00346}00346\ \ \ \ \ \textcolor{comment}{//\ Acquire\ the\ object\ table.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00347}00347\ \ \ \ \ \mbox{\hyperlink{ht_8h_a7ef9aee766b45c680842fc726fb6cb7f}{PHANDLE\_TABLE}}\ ObjectTable\ =\ \mbox{\hyperlink{ps_8h_a1ad0a15fe3e79d2fd18f00bd361d1eef}{PsGetCurrentProcess}}()-\/>\mbox{\hyperlink{struct___e_p_r_o_c_e_s_s_a433fb021c56e2c0fdbdec96ea9dcecab}{ObjectTable}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00348}00348\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ObjectTable)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a4bba88197d1ce048dc3d8755222b7373}{MT\_INVALID\_ADDRESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00349}00349\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00350}00350\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ handle.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00351}00351\ \ \ \ \ \mbox{\hyperlink{ht_8h_a84a85b4c81f3ad61278cc4473a44f202}{HANDLE}}\ Handle\ =\ \mbox{\hyperlink{handle_8c_a4ad24010cc4b9f4331e7ab83c2967fef}{HtCreateHandle}}(ObjectTable,\ Object,\ DesiredAccess);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00352}00352\ \ \ \ \ \textcolor{keywordflow}{if}\ (Handle\ ==\ \mbox{\hyperlink{mtstatus_8h_aa7188fae8aa0195501b03f629a441554}{MT\_INVALID\_HANDLE}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_acc984fa35b66767efe0d221887252596}{MT\_INVALID\_CHECK}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00353}00353\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00354}00354\ \ \ \ \ \textcolor{comment}{//\ Reference\ the\ object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00355}00355\ \ \ \ \ \mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{ObReferenceObject}}(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00356}00356\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00357}00357\ \ \ \ \ \textcolor{comment}{//\ Return\ success.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00358}00358\ \ \ \ \ *ReturnedHandle\ =\ Handle;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00359}00359\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00360}00360\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00361}00361\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00362}00362\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00363}\mbox{\hyperlink{ob_8c_a70b2e47218e2d92659efb010e14c5993}{00363}}\ \mbox{\hyperlink{ob_8c_a70b2e47218e2d92659efb010e14c5993}{ObCreateHandleForObjectEx}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00364}00364\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{void}*\ Object,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00365}00365\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ht_8h_a18b1b4f2fb3e795e24fd8eddc2b48c08}{ACCESS\_MASK}}\ DesiredAccess,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00366}00366\ \ \ \ \ \mbox{\hyperlink{annotations_8h_aec78e7a9e90a406a56f859ee456e8eae}{OUT}}\ \mbox{\hyperlink{ht_8h_a4eff5701246ce814577877fc805928de}{PHANDLE}}\ ReturnedHandle,}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00367}00367\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ht_8h_a7ef9aee766b45c680842fc726fb6cb7f}{PHANDLE\_TABLE}}\ ObjectTable}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00368}00368\ )}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00369}00369\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00370}00370\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00371}00371\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00372}00372\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00373}00373\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00374}00374\ \textcolor{comment}{\ \ \ \ \ \ \ Creates\ a\ handle\ in\ the\ specified\ handle\ table\ for\ the\ specified\ Object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00375}00375\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00376}00376\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00377}00377\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00378}00378\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ Object\ -\/\ The\ object\ to\ create\ the\ handle\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00379}00379\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ ACCESS\_MASK\ DesiredAccess\ -\/\ The\ maximum\ access\ the\ handle\ should\ have.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00380}00380\ \textcolor{comment}{\ \ \ \ \ \ \ \ [OUT]\ \ \ PHANDLE\ ReturnedHandle\ -\/\ The\ returned\ handle\ for\ the\ object\ if\ success.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00381}00381\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ PHANDLE\_TABLE\ ObjectTable\ -\/\ The\ handle\ table\ to\ insert\ the\ newly\ created\ handle\ in.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00382}00382\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00383}00383\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00384}00384\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00385}00385\ \textcolor{comment}{\ \ \ \ \ \ \ \ MTSTATUS\ Status\ Codes:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00386}00386\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00387}00387\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_SUCCESS\ -\/\ Successful.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00388}00388\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_INVALID\_STATE\ -\/\ No\ handle\ table\ for\ current\ process.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00389}00389\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MT\_INVALID\_CHECK\ -\/\ HtCreateHandle\ returned\ MT\_INVALID\_HANDLE.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00390}00390\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00391}00391\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00392}00392\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00393}00393\ \ \ \ \ \textcolor{keywordflow}{if}\ (!ObjectTable\ ||\ !Object)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a4bba88197d1ce048dc3d8755222b7373}{MT\_INVALID\_ADDRESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00394}00394\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00395}00395\ \ \ \ \ \textcolor{comment}{//\ Create\ the\ handle.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00396}00396\ \ \ \ \ \mbox{\hyperlink{ht_8h_a84a85b4c81f3ad61278cc4473a44f202}{HANDLE}}\ Handle\ =\ \mbox{\hyperlink{handle_8c_a4ad24010cc4b9f4331e7ab83c2967fef}{HtCreateHandle}}(ObjectTable,\ Object,\ DesiredAccess);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00397}00397\ \ \ \ \ \textcolor{keywordflow}{if}\ (Handle\ ==\ \mbox{\hyperlink{mtstatus_8h_aa7188fae8aa0195501b03f629a441554}{MT\_INVALID\_HANDLE}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_acc984fa35b66767efe0d221887252596}{MT\_INVALID\_CHECK}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00398}00398\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00399}00399\ \ \ \ \ \textcolor{comment}{//\ Reference\ the\ object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00400}00400\ \ \ \ \ \mbox{\hyperlink{ob_8c_a9c0083927d724a73a83b8d5577d7c970}{ObReferenceObject}}(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00401}00401\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00402}00402\ \ \ \ \ \textcolor{comment}{//\ Return\ success.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00403}00403\ \ \ \ \ *ReturnedHandle\ =\ Handle;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00404}00404\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00405}00405\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00406}00406\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00407}00407\ \textcolor{keyword}{static}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00408}00408\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00409}00409\ ObpDeferObjectDeletion(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00410}00410\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00411}00411\ )}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00412}00412\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00413}00413\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00414}00414\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00415}00415\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00416}00416\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00417}00417\ \textcolor{comment}{\ \ \ \ \ \ \ Defers\ object\ deletion\ to\ a\ DPC,\ to\ ensure\ no\ use\ after\ free.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00418}00418\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00419}00419\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00420}00420\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00421}00421\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ POBJECT\_HEADER\ Header\ -\/\ The\ object\ header\ to\ defer\ deletion\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00422}00422\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00423}00423\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00424}00424\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00425}00425\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00426}00426\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00427}00427\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00428}00428\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00429}00429\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00430}00430\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{void}*\ Entry;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00431}00431\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00432}00432\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ current\ entry.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00433}00433\ \ \ \ \ \ \ \ \ Entry\ =\ \mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{ObpReaperList}};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00434}00434\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00435}00435\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Link\ our\ object\ to\ the\ linked\ list.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00436}00436\ \ \ \ \ \ \ \ \ Header-\/>NextToFree\ =\ Entry;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00437}00437\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ the\ list}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00438}00438\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (\mbox{\hyperlink{atomic_8h_a621e53084ddf7c5cf1b80abcfc2f4b0f}{InterlockedCompareExchangePointer}}(\&\mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{ObpReaperList}},\ Header,\ (\textcolor{keywordtype}{void}*)Entry)\ !=\ Entry);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00439}00439\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00440}00440\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Entry)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00441}00441\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Looks\ like\ a\ DPC\ hasn't\ been\ queued\ yet,\ lets\ do\ so!}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00442}00442\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{dpc_8c_a693b51ec9479301c4651c9c623d784fa}{MeInsertQueueDpc}}(\&\mbox{\hyperlink{ob_8c_a97ac199eae2eba0160eeda6409fb6838}{ObpReaperDpc}},\ NULL,\ NULL);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00443}00443\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00444}00444\ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00445}00445\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00446}\mbox{\hyperlink{ob_8c_a7dee8ead706a375c2a916dc9ed752224}{00446}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{ob_8c_a7dee8ead706a375c2a916dc9ed752224}{ObDereferenceObject}}(}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00447}00447\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \ \textcolor{keywordtype}{void}*\ Object}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00448}00448\ )\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00449}00449\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00450}00450\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00451}00451\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00452}00452\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00453}00453\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00454}00454\ \textcolor{comment}{\ \ \ \ \ \ \ Dereferences\ the\ Object\ given.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00455}00455\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00456}00456\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00457}00457\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00458}00458\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ Object\ -\/\ The\ Object\ to\ decrement\ reference\ count\ for.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00459}00459\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00460}00460\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00461}00461\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00462}00462\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00463}00463\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00464}00464\ \textcolor{comment}{\ \ \ \ Notes:}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00465}00465\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00466}00466\ \textcolor{comment}{\ \ \ \ \ \ \ \ On\ reference\ count\ 0,\ object\ is\ deleted\ using\ type\ initializer\ routine.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00467}00467\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00468}00468\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00469}00469\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00470}00470\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00471}00471\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Object)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00472}00472\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ Header\ =\ \mbox{\hyperlink{ob_8h_acd993b46cb8205b25d9cc1f9c6959a59}{OBJECT\_TO\_OBJECT\_HEADER}}(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00473}00473\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00474}00474\ \ \ \ \ uint64\_t\ NewCount\ =\ \mbox{\hyperlink{atomic_8h_a7d3179efc4f0416b59ae569a96a33ba2}{InterlockedDecrementU64}}((\textcolor{keyword}{volatile}\ uint64\_t*)\&Header-\/>PointerCount);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00475}00475\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00476}00476\ \ \ \ \ \textcolor{keywordflow}{if}\ (NewCount\ ==\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00477}00477\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Get\ the\ type\ initializer\ for\ the\ object.}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00478}00478\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ob_8h_a1090c1618ef4082635e12605b8832a46}{POBJECT\_TYPE}}\ \mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}\ =\ Header-\/>Type;}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00479}00479\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00480}00480\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00481}00481\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ First\ call\ debug\ callback\ if\ exists}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00482}00482\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}-\/>TypeInfo.DumpProcedure)\ \mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}-\/>TypeInfo.DumpProcedure(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00483}00483\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00484}00484\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00485}00485\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Call\ Delete\ Callback\ if\ it\ exists}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00486}00486\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}-\/>TypeInfo.DeleteProcedure)\ \mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}-\/>TypeInfo.DeleteProcedure(Object);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00487}00487\ }
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00488}00488\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Update\ Stats}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00489}00489\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{atomic_8h_a7d155446a14ecbfb5bd6e0abf7b6cb93}{InterlockedDecrementU32}}((\textcolor{keyword}{volatile}\ uint32\_t*)\&\mbox{\hyperlink{ob_8h_a1315300e1fb04501ea108c2e8f1ee738}{Type}}-\/>TotalNumberOfObjects);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00490}00490\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Free\ Memory}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00491}00491\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gop_8c_a41ff1165c1969706dadb5b409ae082e9}{gop\_printf}}(\mbox{\hyperlink{mg_8h_ad86358bf19927183dd7b4ae215a29731}{COLOR\_RED}},\ \textcolor{stringliteral}{"{}Freeing\ the\ header\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00492}00492\ \ \ \ \ \ \ \ \ \textcolor{comment}{//ObpDeferObjectDeletion(Header);}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00493}00493\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pool_8c_ac850e1b4ef3a12e327c5e76bb8fae748}{MmFreePool}}(Header);}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00494}00494\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{ob_8c_source_l00495}00495\ \}}

\end{DoxyCode}
