\doxysection{debugfunctions.\+c}
\hypertarget{debugfunctions_8c_source}{}\label{debugfunctions_8c_source}\index{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/md/debugfunctions.c@{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/md/debugfunctions.c}}
\mbox{\hyperlink{debugfunctions_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00001}00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00002}00002\ \textcolor{comment}{\ *\ PROJECT:\ \ \ \ \ MatanelOS\ Kernel}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00003}00003\ \textcolor{comment}{\ *\ LICENSE:\ \ \ \ \ GPLv3}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00004}00004\ \textcolor{comment}{\ *\ PURPOSE:\ \ \ \ \ Debugging\ Functions\ Implementation.}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00005}00005\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00007}00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{md_8h}{../../includes/md.h}}"{}}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00008}00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mh_8h}{../../includes/mh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00010}00010\ \ \textcolor{comment}{/*\ Find\ a\ free\ debug\ slot\ (0..3)\ or\ -\/1\ if\ none\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00011}\mbox{\hyperlink{debugfunctions_8c_a4ed5b57ae1d96ae6fd39aa792fc0c2e4}{00011}}\ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{debugfunctions_8c_a4ed5b57ae1d96ae6fd39aa792fc0c2e4}{find\_available\_debug\_reg}}(\textcolor{keywordtype}{void})\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00012}00012\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00013}00013\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>DebugEntry[i].Callback\ ==\ NULL)\ \textcolor{keywordflow}{return}\ i;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00014}00014\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00015}00015\ \ \ \ \ \textcolor{keywordflow}{return}\ -\/1;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00016}00016\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00018}00018\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ write\_dr\_idx(\textcolor{keywordtype}{int}\ idx,\ uint64\_t\ value)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00019}00019\ \ \ \ \ \mbox{\hyperlink{intrin_8h_aab96655396a1cc834edfbc9b021b6092}{\_\_write\_dr}}(idx,\ value);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00020}00020\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00021}00021\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ uint64\_t\ read\_dr7(\textcolor{keywordtype}{void})\ \{\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{intrin_8h_a41b087e19c6e22ca6be38752af62688b}{\_\_read\_dr}}(7);\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00022}00022\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ write\_dr7(uint64\_t\ v)\ \{\ \mbox{\hyperlink{intrin_8h_aab96655396a1cc834edfbc9b021b6092}{\_\_write\_dr}}(7,\ v);\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00023}00023\ \textcolor{keyword}{static}\ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ write\_dr6(uint64\_t\ v)\ \{\ \mbox{\hyperlink{intrin_8h_aab96655396a1cc834edfbc9b021b6092}{\_\_write\_dr}}(6,\ v);\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00025}00025\ \textcolor{comment}{//\ PUBLIC\ API}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00026}\mbox{\hyperlink{debugfunctions_8c_aabfdb7ee24150ca0fffb6de9f9a9d569}{00026}}\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}\ \mbox{\hyperlink{debugfunctions_8c_aabfdb7ee24150ca0fffb6de9f9a9d569}{MdSetHardwareBreakpoint}}(\mbox{\hyperlink{me_8h_a87af053432c9fa1831a72cd46386a83e}{DebugCallback}}\ CallbackFunction,\ \textcolor{keywordtype}{void}*\ BreakpointAddress,\ \mbox{\hyperlink{me_8h_a63130c796979ed304ac596fa7c3d2806}{DEBUG\_ACCESS\_MODE}}\ AccessMode,\ \mbox{\hyperlink{me_8h_aae86b30a268f0bcfa90e03239a701a8d}{DEBUG\_LENGTH}}\ \mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}})\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00027}00027\ \ \ \ \ \textcolor{keywordflow}{if}\ (!CallbackFunction\ ||\ !BreakpointAddress)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00028}00028\ \ \ \ \ \textcolor{keywordflow}{if}\ (AccessMode\ ==\ \mbox{\hyperlink{me_8h_aeceb6ff71282fd15cc72270d67a6ee63ab9fba8c7e699d7800f18b9fd9aa5e339}{DEBUG\_ACCESS\_IO}})\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a3f63df5b525aeed240a0798a736a0127}{MT\_NOT\_IMPLEMENTED}};\ \textcolor{comment}{/*\ legacy\ /\ not\ handled\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00029}00029\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00030}00030\ \ \ \ \ \textcolor{comment}{/*\ Validate\ length\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00031}00031\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}}\ !=\ \mbox{\hyperlink{me_8h_a9d378f06771ba5412480397cc9ef65e2a93b75547a87a8c3df72b03bd89d10e82}{DEBUG\_LEN\_BYTE}}\ \&\&\ \mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}}\ !=\ \mbox{\hyperlink{me_8h_a9d378f06771ba5412480397cc9ef65e2ae543ebcd171adc65e39fde4416f64aaf}{DEBUG\_LEN\_DWORD}}\ \&\&\ \mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}}\ !=\ \mbox{\hyperlink{me_8h_a9d378f06771ba5412480397cc9ef65e2a6ac7f1a102b3b49727804f3a6c260973}{DEBUG\_LEN\_WORD}}\ \&\&\ \mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}}\ !=\ \mbox{\hyperlink{me_8h_a9d378f06771ba5412480397cc9ef65e2a1d50025f976a1d72fa54f77a3fd00606}{DEBUG\_LEN\_QWORD}})}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00032}00032\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00033}00033\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00034}00034\ \ \ \ \ \textcolor{keywordtype}{int}\ idx\ =\ \mbox{\hyperlink{debugfunctions_8c_a4ed5b57ae1d96ae6fd39aa792fc0c2e4}{find\_available\_debug\_reg}}();}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (idx\ ==\ -\/1)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_ac3aa7acc02bb56d3bcd59419f84ce9a5}{MT\_NO\_RESOURCES}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00036}00036\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00037}00037\ \ \ \ \ uint64\_t\ addr\ =\ (uint64\_t)BreakpointAddress;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00038}00038\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00039}00039\ \ \ \ \ \textcolor{comment}{/*\ Write\ address\ into\ DRx\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00040}00040\ \ \ \ \ write\_dr\_idx(idx,\ addr);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00042}00042\ \ \ \ \ \textcolor{comment}{/*\ Clear\ DR6\ status\ before\ enabling\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00043}00043\ \ \ \ \ write\_dr6(0);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00045}00045\ \ \ \ \ \textcolor{comment}{/*\ Modify\ DR7\ safely:\ only\ change\ bits\ for\ our\ breakpoint\ index\ and\ the\ local-\/enable\ bit\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00046}00046\ \ \ \ \ uint64\_t\ dr7\ =\ read\_dr7();}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00048}00048\ \ \ \ \ \textcolor{comment}{/*\ set\ local\ enable\ bit\ Lx\ (bit\ 0,2,4,6\ for\ idx\ 0..3)\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00049}00049\ \ \ \ \ dr7\ |=\ (1ULL\ <<\ (idx\ *\ 2));}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00050}00050\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00051}00051\ \ \ \ \ \textcolor{comment}{/*\ Build\ the\ 4-\/bit\ RW/LEN\ field\ value:\ low\ 2\ bits\ =\ RW,\ high\ 2\ bits\ =\ LEN\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00052}00052\ \ \ \ \ uint64\_t\ group\_val\ =\ ((((uint64\_t)\mbox{\hyperlink{mh_8h_af8d8a0e464944d6e219e87ef2f33d2e0}{Length}})\ \&\ 0x3ULL)\ <<\ 2)\ |\ (((uint64\_t)AccessMode)\ \&\ 0x3ULL);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00053}00053\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00054}00054\ \ \ \ \ \textcolor{comment}{/*\ Clear\ existing\ 4-\/bit\ group\ and\ set\ new\ one\ at\ bits\ (16\ +\ 4*idx\ ..\ 19\ +\ 4*idx)\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00055}00055\ \ \ \ \ uint64\_t\ mask\ =\ 0xFULL\ <<\ (16\ +\ 4\ *\ idx);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00056}00056\ \ \ \ \ dr7\ \&=\ \string~mask;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00057}00057\ \ \ \ \ dr7\ |=\ (group\_val\ <<\ (16\ +\ 4\ *\ idx));}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00058}00058\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00059}00059\ \ \ \ \ write\_dr7(dr7);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00061}00061\ \ \ \ \ \textcolor{comment}{//\ Save\ in\ the\ DEBUG\ db\ so\ the\ INT1\ will\ handle\ it.}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00062}00062\ \ \ \ \ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a1b30347604d6b08a6d9e7f81efc72b59}{DebugEntry}}[idx].\mbox{\hyperlink{struct___d_e_b_u_g___e_n_t_r_y_ae0cc8a5c23a59a178d241a27f12b1ef5}{Address}}\ =\ BreakpointAddress;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00063}00063\ \ \ \ \ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a1b30347604d6b08a6d9e7f81efc72b59}{DebugEntry}}[idx].\mbox{\hyperlink{struct___d_e_b_u_g___e_n_t_r_y_a65bc266cb43a4bad87dadf0bc59bb039}{Callback}}\ =\ CallbackFunction;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00064}00064\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00065}00065\ \ \ \ \ \mbox{\hyperlink{mh_8h_a31e6d7d3d740029297de19620af57ae4}{IPI\_PARAMS}}\ params;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00066}00066\ \ \ \ \ \mbox{\hyperlink{mm_8h_a7d9455da4f2ec94a98286a19e7d8e39d}{kmemset}}(\&params,\ 0,\ \textcolor{keyword}{sizeof}(\mbox{\hyperlink{mh_8h_a31e6d7d3d740029297de19620af57ae4}{IPI\_PARAMS}}));}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00067}00067\ \ \ \ \ params.\mbox{\hyperlink{struct___i_p_i___p_a_r_a_m_s_af5f4a8aa97cf682fb972dee7cd60d867}{debugRegs}}.\mbox{\hyperlink{struct___d_e_b_u_g___r_e_g_i_s_t_e_r_s_ab6b52376c1b9d81e6ea6f95a1225f832}{address}}\ =\ addr;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00068}00068\ \ \ \ \ params.\mbox{\hyperlink{struct___i_p_i___p_a_r_a_m_s_af5f4a8aa97cf682fb972dee7cd60d867}{debugRegs}}.\mbox{\hyperlink{struct___d_e_b_u_g___r_e_g_i_s_t_e_r_s_abd2f2465bea5b1173cb372c4e8a834f4}{dr7}}\ =\ dr7;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00069}00069\ \ \ \ \ params.\mbox{\hyperlink{struct___i_p_i___p_a_r_a_m_s_af5f4a8aa97cf682fb972dee7cd60d867}{debugRegs}}.\mbox{\hyperlink{struct___d_e_b_u_g___r_e_g_i_s_t_e_r_s_af774e8ec9dc9fbc5084312994b3640c3}{callback}}\ =\ CallbackFunction;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00070}00070\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00071}00071\ \ \ \ \ \mbox{\hyperlink{smp_8c_af16af21e540d45a136cbff3f1cd766f0}{MhSendActionToCpusAndWait}}(\mbox{\hyperlink{mh_8h_a1284f96951816db55a31764685872bb4a45aab8fb9fc3af5a44aaff5c08710649}{CPU\_ACTION\_WRITE\_DEBUG\_REGS}},\ params);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00073}00073\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00074}00074\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00075}00075\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a3f63df5b525aeed240a0798a736a0127}{MT\_NOT\_IMPLEMENTED}};\ \textcolor{comment}{//\ On\ release\ builds,\ this\ should\ be\ toggled\ off,\ as\ the\ system\ is\ in\ a\ controlled\ environment,\ plus\ this\ would\ corrupt\ user\ debug\ registers.}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00076}00076\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00077}00077\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00079}\mbox{\hyperlink{debugfunctions_8c_a6f17ddbd51eef93879c460b125b3c27a}{00079}}\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}\ \mbox{\hyperlink{debugfunctions_8c_a6f17ddbd51eef93879c460b125b3c27a}{MdClearHardwareBreakpointByIndex}}(\textcolor{keywordtype}{int}\ index)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00080}00080\ \ \ \ \ \textcolor{keywordflow}{if}\ (index\ <\ 0\ ||\ index\ >\ 3)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00081}00081\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>DebugEntry[index].Callback\ ==\ NULL\ \&\&\ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>DebugEntry[index].\mbox{\hyperlink{mh_8h_a910d8dd637ddefc515335aa801391980}{Address}}\ ==\ NULL)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_aafd803b321d036759d81fd68163ea0fd}{MT\_NOT\_FOUND}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00083}00083\ \ \ \ \ \textcolor{comment}{/*\ Clear\ DRx\ address\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00084}00084\ \ \ \ \ write\_dr\_idx(index,\ 0);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00086}00086\ \ \ \ \ \textcolor{comment}{/*\ Clear\ DR7\ bits\ for\ this\ index\ (local\ enable\ and\ RW/LEN\ group)\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00087}00087\ \ \ \ \ uint64\_t\ dr7\ =\ read\_dr7();}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00088}00088\ \ \ \ \ \textcolor{comment}{/*\ clear\ local\ enable\ bit\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00089}00089\ \ \ \ \ dr7\ \&=\ \string~(1ULL\ <<\ (index\ *\ 2));}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00090}00090\ \ \ \ \ \textcolor{comment}{/*\ clear\ RW/LEN\ 4-\/bit\ group\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00091}00091\ \ \ \ \ uint64\_t\ mask\ =\ 0xFULL\ <<\ (16\ +\ 4\ *\ index);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00092}00092\ \ \ \ \ dr7\ \&=\ \string~mask;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00093}00093\ \ \ \ \ write\_dr7(dr7);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00094}00094\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00095}00095\ \ \ \ \ \textcolor{comment}{/*\ Clear\ status\ DR6\ too\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00096}00096\ \ \ \ \ write\_dr6(0);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00097}00097\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00098}00098\ \ \ \ \ \mbox{\hyperlink{mh_8h_a31e6d7d3d740029297de19620af57ae4}{IPI\_PARAMS}}\ params;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00099}00099\ \ \ \ \ params.\mbox{\hyperlink{struct___i_p_i___p_a_r_a_m_s_af5f4a8aa97cf682fb972dee7cd60d867}{debugRegs}}.\mbox{\hyperlink{struct___d_e_b_u_g___r_e_g_i_s_t_e_r_s_ab6b52376c1b9d81e6ea6f95a1225f832}{address}}\ =\ (uint64\_t)\mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a1b30347604d6b08a6d9e7f81efc72b59}{DebugEntry}}[index].\mbox{\hyperlink{struct___d_e_b_u_g___e_n_t_r_y_ae0cc8a5c23a59a178d241a27f12b1ef5}{Address}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00101}00101\ \ \ \ \ \textcolor{comment}{/*\ Clear\ table\ entry\ */}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00102}00102\ \ \ \ \ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a1b30347604d6b08a6d9e7f81efc72b59}{DebugEntry}}[index].\mbox{\hyperlink{struct___d_e_b_u_g___e_n_t_r_y_a65bc266cb43a4bad87dadf0bc59bb039}{Callback}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00103}00103\ \ \ \ \ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a1b30347604d6b08a6d9e7f81efc72b59}{DebugEntry}}[index].\mbox{\hyperlink{struct___d_e_b_u_g___e_n_t_r_y_ae0cc8a5c23a59a178d241a27f12b1ef5}{Address}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00104}00104\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00105}00105\ \ \ \ \ \mbox{\hyperlink{smp_8c_af16af21e540d45a136cbff3f1cd766f0}{MhSendActionToCpusAndWait}}(\mbox{\hyperlink{mh_8h_a1284f96951816db55a31764685872bb4ab2c5fef4a9580a4f57af3729b7e091ba}{CPU\_ACTION\_CLEAR\_DEBUG\_REGS}},\ params);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00107}00107\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a147849337a41d8be9ccb4ef599b84a86}{MT\_SUCCESS}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00108}00108\ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00110}\mbox{\hyperlink{debugfunctions_8c_a7cb2e647dc875cc8423f1b155e51c3d5}{00110}}\ \mbox{\hyperlink{mtstatus_8h_a7c794b38d203a5b842f27b12fb55495a}{MTSTATUS}}\ \mbox{\hyperlink{debugfunctions_8c_a7cb2e647dc875cc8423f1b155e51c3d5}{MdClearHardwareBreakpointByAddress}}(\textcolor{keywordtype}{void}*\ BreakpointAddress)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00111}00111\ \ \ \ \ \textcolor{keywordflow}{if}\ (!BreakpointAddress)\ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_a55458e0861f6a58c2bc62538f93609ce}{MT\_INVALID\_PARAM}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00112}00112\ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ 0;\ i\ <\ 4;\ ++i)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00113}00113\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}()-\/>DebugEntry[i].\mbox{\hyperlink{mh_8h_a910d8dd637ddefc515335aa801391980}{Address}}\ ==\ BreakpointAddress)\ \{}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{debugfunctions_8c_a6f17ddbd51eef93879c460b125b3c27a}{MdClearHardwareBreakpointByIndex}}(i);}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00115}00115\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00116}00116\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00117}00117\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{mtstatus_8h_aafd803b321d036759d81fd68163ea0fd}{MT\_NOT\_FOUND}};}
\DoxyCodeLine{\Hypertarget{debugfunctions_8c_source_l00118}00118\ \}}

\end{DoxyCode}
