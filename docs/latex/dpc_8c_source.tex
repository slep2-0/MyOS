\doxysection{dpc.\+c}
\hypertarget{dpc_8c_source}{}\label{dpc_8c_source}\index{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/me/dpc.c@{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/core/me/dpc.c}}
\mbox{\hyperlink{dpc_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00001}00001\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00002}00002\ \textcolor{comment}{\ *\ PROJECT:\ \ \ \ \ \ MatanelOS\ Kernel}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00003}00003\ \textcolor{comment}{\ *\ LICENSE:\ \ \ \ \ \ GPLv3}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00004}00004\ \textcolor{comment}{\ *\ PURPOSE:\ \ \ \ \ \ DPC\ Implementation.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00005}00005\ \textcolor{comment}{\ */}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00007}00007\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{me_8h}{../../includes/me.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00008}00008\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mg_8h}{../../includes/mg.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00009}00009\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ps_8h}{../../includes/ps.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00010}00010\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{mh_8h}{../../includes/mh.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00011}00011\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{assert_8h}{../../assert.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00012}00012\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{ob_8h}{../../includes/ob.h}}"{}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00014}00014\ \textcolor{comment}{//Statically\ made\ DPC\ Routines.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00016}00016\ \textcolor{keyword}{extern}\ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{void}*\ \mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{ObpReaperList}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00017}00017\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00018}\mbox{\hyperlink{dpc_8c_abdd0a726135e1e29003297d864243ebc}{00018}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{dpc_8c_abdd0a726135e1e29003297d864243ebc}{ReapOb}}(\mbox{\hyperlink{me_8h_ab4a5c3c2096f05e5f0db35f80685b4a2}{DPC}}*\ dpc,\ \textcolor{keywordtype}{void}*\ DeferredContext,\ \textcolor{keywordtype}{void}*\ SystemArgument1,\ \textcolor{keywordtype}{void}*\ SystemArgument2)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00019}00019\ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00020}00020\ \textcolor{comment}{\ \ \ \ DeferredContext\ -\/\ Ignored}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00021}00021\ \textcolor{comment}{\ \ \ \ SystemArgument1\ -\/\ Ignored}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00022}00022\ \textcolor{comment}{\ \ \ \ SystemArgument2\ -\/\ Ignored}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00023}00023\ \textcolor{comment}{\ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00025}00025\ \ \ \ \ \mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}}\ head,\ cur;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00026}00026\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00027}00027\ \ \ \ \ \mbox{\hyperlink{intrin_8h_a7b1a47a94be3cc9455621cecad58b168}{UNREFERENCED\_PARAMETER}}(DeferredContext);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00028}00028\ \ \ \ \ \mbox{\hyperlink{intrin_8h_a7b1a47a94be3cc9455621cecad58b168}{UNREFERENCED\_PARAMETER}}(SystemArgument1);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00029}00029\ \ \ \ \ \mbox{\hyperlink{intrin_8h_a7b1a47a94be3cc9455621cecad58b168}{UNREFERENCED\_PARAMETER}}(SystemArgument2);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00030}00030\ \ \ \ \ \mbox{\hyperlink{intrin_8h_a7b1a47a94be3cc9455621cecad58b168}{UNREFERENCED\_PARAMETER}}(dpc);\ \textcolor{comment}{//\ Switched\ to\ global,\ freeing\ this\ would\ cause\ in\ MEMORY\_CORRUPT\_HEADER.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00031}00031\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00032}00032\ \ \ \ \ \textcolor{comment}{//\ Atomically\ take\ the\ list}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00033}00033\ \ \ \ \ head\ =\ (\mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}})\mbox{\hyperlink{atomic_8h_a7a32c0adbc7897dfdd8be0bbe2fa79c2}{InterlockedExchangePointer}}(\&\mbox{\hyperlink{dpc_8c_a8e865b7f3f75266d2ac2ebbeda776520}{ObpReaperList}},\ NULL);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00034}00034\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00035}00035\ \ \ \ \ \textcolor{comment}{//\ Walk\ the\ captured\ chain\ and\ free\ each\ header}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00036}00036\ \ \ \ \ \textcolor{keywordflow}{while}\ (head)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00037}00037\ \ \ \ \ \ \ \ \ cur\ =\ head;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00038}00038\ \ \ \ \ \ \ \ \ head\ =\ (\mbox{\hyperlink{ob_8h_a4cf25ca68172437be6e63daf06e4f379}{POBJECT\_HEADER}})head-\/>NextToFree;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00039}00039\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{pool_8c_ac850e1b4ef3a12e327c5e76bb8fae748}{MmFreePool}}(cur);\ \textcolor{comment}{//\ Free\ the\ header\ (frees\ object\ as\ well,\ header\ +\ sizeof(header)\ =\ object)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00040}00040\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00042}00042\ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00044}00044\ \textcolor{comment}{//End}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00045}00045\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00046}00046\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00047}\mbox{\hyperlink{dpc_8c_a693b51ec9479301c4651c9c623d784fa}{00047}}\ \mbox{\hyperlink{dpc_8c_a693b51ec9479301c4651c9c623d784fa}{MeInsertQueueDpc}}(}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00048}00048\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_af17808df1561cc593973d56446dfa44f}{PDPC}}\ Dpc,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00049}00049\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{void}*\ SystemArgument1,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00050}00050\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{void}*\ SystemArgument2}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00051}00051\ )}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00053}00053\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00054}00054\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00055}00055\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00056}00056\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00057}00057\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ inserts\ the\ DPC\ object\ into\ the\ DPC\ queue.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00058}00058\ \textcolor{comment}{\ \ \ \ \ \ \ \ If\ the\ DPC\ object\ is\ already\ in\ the\ queue,\ nothing\ is\ performed.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00059}00059\ \textcolor{comment}{\ \ \ \ \ \ \ \ Else,\ the\ DPC\ Object\ is\ inserted\ in\ the\ queue,\ and\ a\ software\ interrupt\ is\ generated\ based\ on\ the\ DPC\ priority\ \&\ current\ depth.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00060}00060\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00061}00061\ \textcolor{comment}{\ \ \ \ \ \ \ \ For\ setting\ a\ certain\ CPU\ to\ run\ this\ DPC,\ use\ the\ MeSetTargetProcessorDpc\ function\ before\ calling\ this\ one.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00062}00062\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00063}00063\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00064}00064\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00065}00065\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ PDPC\ Dpc\ -\/\ The\ DPC\ Object\ to\ queue.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00066}00066\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ SystemArgument1\ -\/\ Optional\ Argument\ for\ the\ DPC\ to\ receive.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00067}00067\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ void*\ SystemArgument2\ -\/\ Optional\ Argument\ for\ the\ DPC\ to\ receive.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00068}00068\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00069}00069\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00070}00070\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00071}00071\ \textcolor{comment}{\ \ \ \ \ \ \ \ If\ the\ DPC\ objeect\ is\ already\ in\ the\ queue,\ false\ is\ returned.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00072}00072\ \textcolor{comment}{\ \ \ \ \ \ \ \ Otherwise,\ true\ is\ returned.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00073}00073\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00074}00074\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00076}00076\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00077}00077\ \ \ \ \ \textcolor{comment}{//\ Declarations}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00078}00078\ \ \ \ \ \mbox{\hyperlink{me_8h_a86b25bba13bd746ea53fcf8a2386b964}{PDPC\_DATA}}\ DpcData;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00079}00079\ \ \ \ \ \mbox{\hyperlink{core_8h_a70c4f07737f0f901b6b34b4655c9ee42}{PPROCESSOR}}\ Cpu;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00080}00080\ \ \ \ \ \textcolor{keywordtype}{bool}\ Inserted\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00081}00081\ \ \ \ \ \mbox{\hyperlink{core_8h_a7258ea91cea6c1c174df48f6225ef4da}{IRQL}}\ OldIrql;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00083}00083\ \ \ \ \ \textcolor{keywordflow}{if}\ (!Dpc-\/>DeferredRoutine)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00084}00084\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00085}00085\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bugcheck_8c_a6ec4513aac495ad65f57eef09b218058}{MeBugCheckEx}}(\mbox{\hyperlink{me_8h_a3dd6c077b2422dcc0d05246537da5c82aa82f26189663b2bf1043d30f1c551004}{DPC\_NOT\_INITIALIZED}},}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00086}00086\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{void}*)(uintptr\_t)\mbox{\hyperlink{macros_8h_ac404dd901aac7a34d882f63dfdfd0095}{RETADDR}}(0),}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{void}*)Dpc,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ NULL,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ NULL}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00090}00090\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00091}00091\ \textcolor{preprocessor}{\#else}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00092}00092\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{bugcheck_8c_a6ec4513aac495ad65f57eef09b218058}{MeBugCheckEx}}(\mbox{\hyperlink{me_8h_a3dd6c077b2422dcc0d05246537da5c82aa82f26189663b2bf1043d30f1c551004}{DPC\_NOT\_INITIALIZED}},}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00093}00093\ \ \ \ \ \ \ \ \ \ \ \ \ (\textcolor{keywordtype}{void}*)Dpc,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ NULL,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ NULL,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ NULL}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00097}00097\ \ \ \ \ \ \ \ \ );}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00098}00098\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00099}00099\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00100}00100\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00101}00101\ \ \ \ \ \textcolor{comment}{//\ Raise\ IRQL\ to\ HIGH\_LEVEL\ to\ prevent\ all\ interrupts\ while\ we\ touch\ the\ processor\ DPC\ queue.\ (prevent\ corruption)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00102}00102\ \ \ \ \ \mbox{\hyperlink{irql_8c_a42f92f7a0268fd7a4fab017deabb8fcf}{MeRaiseIrql}}(\mbox{\hyperlink{core_8h_a6ff101fd8adf1c79792d98893f8dee3ea179bd93cb26ad6988d9665bad27c0bbf}{HIGH\_LEVEL}},\ \&OldIrql);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00104}00104\ \ \ \ \ \textcolor{keywordflow}{if}\ (Dpc-\/>CpuNumber\ <\ \mbox{\hyperlink{me_8h_abc4a08b1fe59de8b6712442b8b3f08e2}{MeGetActiveProcessorCount}}())\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00105}00105\ \ \ \ \ \ \ \ \ Cpu\ =\ \mbox{\hyperlink{smp_8c_a6a5db150bd00268bf389452c5842dffb}{MeGetProcessorBlock}}(Dpc-\/>CpuNumber);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00106}00106\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00107}00107\ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00108}00108\ \ \ \ \ \ \ \ \ Cpu\ =\ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00109}00109\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00110}00110\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00111}00111\ \ \ \ \ DpcData\ =\ \&Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a8c3412414cd69fe255159c3ad61e6580}{DpcData}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00112}00112\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00113}00113\ \ \ \ \ \textcolor{comment}{//\ Acquire\ the\ DpcData\ lock\ for\ the\ current\ processor.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00114}00114\ \ \ \ \ \mbox{\hyperlink{spinlock_8c_ad126d8031fb952a65a0fc565304cdc66}{MsAcquireSpinlockAtDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00116}00116\ \ \ \ \ \textcolor{comment}{//\ Atomic\ operation\ to\ check\ if\ this\ DPC\ is\ already\ queued.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00117}00117\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{atomic_8h_a621e53084ddf7c5cf1b80abcfc2f4b0f}{InterlockedCompareExchangePointer}}(\&Dpc-\/>DpcData,\ DpcData,\ NULL)\ ==\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00119}00119\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Success:\ It\ was\ not\ queued.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00120}00120\ \ \ \ \ \ \ \ \ DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00121}00121\ \ \ \ \ \ \ \ \ DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_ab135fe27a6eaadface92b075fd90e02c}{DpcCount}}\ +=\ 1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00122}00122\ \ \ \ \ \ \ \ \ Dpc-\/>SystemArgument1\ =\ SystemArgument1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00123}00123\ \ \ \ \ \ \ \ \ Dpc-\/>SystemArgument2\ =\ SystemArgument2;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00125}00125\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Insert\ Head\ (High\ Priority)\ or\ Tail\ (Normal)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00126}00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Dpc-\/>priority\ ==\ \mbox{\hyperlink{me_8h_ab43279866db2c797f7ec886b4ac344d6acb1785f11dd02aa7f5d164fb314c594e}{HIGH\_PRIORITY}})\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ms_8h_adcecea0b47aeea240c34aeaaac258559}{InsertHeadList}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a9a558fad628e89bac3eebc7e8f22e979}{DpcListHead}},\ \&Dpc-\/>DpcListEntry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00128}00128\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00129}00129\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ms_8h_abc60fab3d33ed1b1c9f11d1ed674a7b3}{InsertTailList}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a9a558fad628e89bac3eebc7e8f22e979}{DpcListHead}},\ \&Dpc-\/>DpcListEntry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00131}00131\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00132}00132\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00133}00133\ \ \ \ \ \ \ \ \ Inserted\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00134}00134\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Increment\ request\ rate}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00135}00135\ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a080b600f3ac4fe68c0d62feef16080e3}{DpcRequestRate}}++;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00137}00137\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ we\ need\ to\ request\ an\ interurpt}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ We\ only\ request\ if\ a\ DPC\ isnt\ currently\ running.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00139}00139\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ And\ we\ haven't\ already\ requested\ an\ interrupt\ for\ a\ DPC.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00140}00140\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a6bfb22756c90a50ccc04b2a86c40cfa7}{DpcRoutineActive}}\ ==\ \textcolor{keyword}{false})\ \&\&}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00141}00141\ \ \ \ \ \ \ \ \ \ \ \ \ (Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a87c88a9cc221f31eb87ded1defa416e5}{DpcInterruptRequested}}\ ==\ \textcolor{keyword}{false}))\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00143}00143\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ If\ the\ DPC\ priority\ is\ higher\ than\ lowest,\ or\ we\ are\ to\ deep\ in\ the\ queue\ depth,\ retire\ DPCs\ immediately.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ ((Dpc-\/>priority\ !=\ \mbox{\hyperlink{me_8h_ab43279866db2c797f7ec886b4ac344d6adb8ee22a232a2787f32ba28da55c43c1}{LOW\_PRIORITY}})\ ||}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ (DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ >=\ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a7efcdb0e9d4fd1cdda3bf223b20f9b51}{MaximumDpcQueueDepth}}))\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00146}00146\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Always\ mark\ that\ an\ interrupt\ is\ needed\ eventually}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a87c88a9cc221f31eb87ded1defa416e5}{DpcInterruptRequested}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00149}00149\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cannot\ request\ an\ interrupt\ on\ DISPATCH\_LEVEL\ already.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{me_8h_a6abf254a525b635b6dc210cd370536d1}{MeGetCurrentIrql}}()\ <\ \mbox{\hyperlink{core_8h_a6ff101fd8adf1c79792d98893f8dee3ea291292740ec80ec0ff8e2a70c5bdfd6f}{DISPATCH\_LEVEL}})\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Request\ an\ interrupt\ from\ HAL.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{apic_8c_a5fa8dc1090aac3d53a9468b21f95773c}{MhRequestSoftwareInterrupt}}(\mbox{\hyperlink{core_8h_a6ff101fd8adf1c79792d98893f8dee3ea291292740ec80ec0ff8e2a70c5bdfd6f}{DISPATCH\_LEVEL}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00156}00156\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00157}00157\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00159}00159\ \ \ \ \ \textcolor{comment}{//\ Release\ Lock\ and\ Restore\ IRQL}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00160}00160\ \ \ \ \ \mbox{\hyperlink{spinlock_8c_abf7cfc98a356c8cf7f1d20e233a77cc3}{MsReleaseSpinlockFromDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00161}00161\ \ \ \ \ \mbox{\hyperlink{irql_8c_ad07e05df3c335028a1b5ff02de7f3ef2}{MeLowerIrql}}(OldIrql);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00162}00162\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00163}00163\ \ \ \ \ \textcolor{keywordflow}{return}\ Inserted;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00164}00164\ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00166}00166\ \textcolor{keywordtype}{bool}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00167}\mbox{\hyperlink{dpc_8c_a616e1a98354857dc1b20ea740d5c4ba3}{00167}}\ \mbox{\hyperlink{dpc_8c_a616e1a98354857dc1b20ea740d5c4ba3}{MeRemoveQueueDpc}}(}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00168}00168\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_af17808df1561cc593973d56446dfa44f}{PDPC}}\ Dpc}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00169}00169\ )}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00171}00171\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00172}00172\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00173}00173\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00174}00174\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00175}00175\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ removes\ the\ Dpc\ object\ from\ the\ DPC\ Queue.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00176}00176\ \textcolor{comment}{\ \ \ \ \ \ \ \ If\ the\ DPC\ object\ is\ NOT\ in\ the\ DPC\ queue,\ nothing\ is\ performed.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00177}00177\ \textcolor{comment}{\ \ \ \ \ \ \ \ Otherwise,\ the\ DPC\ object\ is\ removed\ from\ the\ queue,\ and\ its\ inserted\ state\ (DpcData),\ is\ NULL\ (false).}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00178}00178\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00179}00179\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00180}00180\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00181}00181\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ \ \ \ PDPC\ Dpc\ -\/\ The\ DPC\ Object\ to\ remove\ from\ queue.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00182}00182\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00183}00183\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00184}00184\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00185}00185\ \textcolor{comment}{\ \ \ \ \ \ \ \ If\ the\ DPC\ object\ is\ not\ in\ the\ queue,\ false\ is\ returned.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00186}00186\ \textcolor{comment}{\ \ \ \ \ \ \ \ Otherwise,\ true\ is\ returned.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00187}00187\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00188}00188\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00189}00189\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00190}00190\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00191}00191\ \ \ \ \ \mbox{\hyperlink{me_8h_a86b25bba13bd746ea53fcf8a2386b964}{PDPC\_DATA}}\ DpcData;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00192}00192\ \ \ \ \ \textcolor{keywordtype}{bool}\ Enable;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00193}00193\ \ \ \ \ \textcolor{keywordtype}{bool}\ Removed\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00194}00194\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00195}00195\ \ \ \ \ \textcolor{comment}{//\ Disable\ interrupts\ manually\ since\ we\ aren't\ raising\ IRQL\ yet}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00196}00196\ \ \ \ \ Enable\ =\ \mbox{\hyperlink{irql_8c_a0b1fa831ad8ad8a91e8510137dcbd255}{MeDisableInterrupts}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00198}00198\ \ \ \ \ DpcData\ =\ (\mbox{\hyperlink{me_8h_a86b25bba13bd746ea53fcf8a2386b964}{PDPC\_DATA}})Dpc-\/>DpcData;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00199}00199\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00200}00200\ \ \ \ \ \textcolor{keywordflow}{if}\ (DpcData\ !=\ NULL)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00201}00201\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Acquire\ Lock}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00202}00202\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{spinlock_8c_ad126d8031fb952a65a0fc565304cdc66}{MsAcquireSpinlockAtDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00203}00203\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00204}00204\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Check\ if\ still\ queued}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (DpcData\ ==\ Dpc-\/>DpcData)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00206}00206\ \ \ \ \ \ \ \ \ \ \ \ \ DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ -\/=\ 1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00207}00207\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ms_8h_aebca627613f330873979f93e89dff9d1}{RemoveEntryList}}(\&Dpc-\/>DpcListEntry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00208}00208\ \ \ \ \ \ \ \ \ \ \ \ \ Dpc-\/>DpcData\ =\ NULL;\ \textcolor{comment}{//\ Mark\ as\ not\ queued}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00209}00209\ \ \ \ \ \ \ \ \ \ \ \ \ Removed\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00210}00210\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00211}00211\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00212}00212\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ Lock}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00213}00213\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{spinlock_8c_abf7cfc98a356c8cf7f1d20e233a77cc3}{MsReleaseSpinlockFromDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00214}00214\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00215}00215\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00216}00216\ \ \ \ \ \textcolor{comment}{//\ Restore\ Interrupts}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00217}00217\ \ \ \ \ \mbox{\hyperlink{irql_8c_a8ed359ce36b3a1000c30116896fe20bb}{MeEnableInterrupts}}(Enable);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00218}00218\ \ \ \ \ \textcolor{keywordflow}{return}\ Removed;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00219}00219\ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00220}00220\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00221}00221\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00222}\mbox{\hyperlink{dpc_8c_a383e4ac532b21a123418732a52de9ad4}{00222}}\ \mbox{\hyperlink{dpc_8c_a383e4ac532b21a123418732a52de9ad4}{MeRetireDPCs}}(}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00223}00223\ \ \ \ \ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00224}00224\ )}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00225}00225\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00226}00226\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00227}00227\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00228}00228\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00229}00229\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00230}00230\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ retires\ the\ DPC\ list\ for\ the\ current\ processor,\ and\ also\ processes\ timer\ expiration\ (first).}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00231}00231\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00232}00232\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00233}00233\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00234}00234\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00235}00235\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00236}00236\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00237}00237\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00238}00238\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00239}00239\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00240}00240\ \textcolor{comment}{\ \ \ \ Notes:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00241}00241\ \textcolor{comment}{\ \ \ \ \ \ \ \ }}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00242}00242\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ is\ entered\ with\ interrupts\ disabled\ (\ \_\_cli()\ ),\ and\ exits\ with\ interrupts\ disabled.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00243}00243\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00244}00244\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00245}00245\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00246}00246\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00247}00247\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00248}00248\ \ \ \ \ \mbox{\hyperlink{gop_8c_a41ff1165c1969706dadb5b409ae082e9}{gop\_printf}}(\mbox{\hyperlink{mg_8h_a9b44987ffdc2af19b635206b94334b69}{COLOR\_WHITE}},\ \textcolor{stringliteral}{"{}Retiring\ DPCs!\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00249}00249\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00250}00250\ \ \ \ \ \textcolor{comment}{//\ Few\ assertions.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00251}00251\ \ \ \ \ \mbox{\hyperlink{assert_8h_a3d4ae9c092e117c836f52dc7d7cee574}{assert}}(\mbox{\hyperlink{me_8h_a6abf254a525b635b6dc210cd370536d1}{MeGetCurrentIrql}}()\ ==\ \mbox{\hyperlink{core_8h_a6ff101fd8adf1c79792d98893f8dee3ea291292740ec80ec0ff8e2a70c5bdfd6f}{DISPATCH\_LEVEL}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00252}00252\ \ \ \ \ \mbox{\hyperlink{assert_8h_a3d4ae9c092e117c836f52dc7d7cee574}{assert}}(\mbox{\hyperlink{irql_8c_a554f81fa12d240c84d378dae18ae4da6}{MeAreInterruptsEnabled}}()\ ==\ \textcolor{keyword}{false});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00253}00253\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00254}00254\ \ \ \ \ \textcolor{comment}{//\ Declarations}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00255}00255\ \ \ \ \ \mbox{\hyperlink{me_8h_af17808df1561cc593973d56446dfa44f}{PDPC}}\ Dpc;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00256}00256\ \ \ \ \ \mbox{\hyperlink{me_8h_a86b25bba13bd746ea53fcf8a2386b964}{PDPC\_DATA}}\ DpcData;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00257}00257\ \ \ \ \ \mbox{\hyperlink{core_8h_a5ab6087d9cf9b1c2356140128e66b95f}{PDOUBLY\_LINKED\_LIST}}\ Entry;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00258}00258\ \ \ \ \ \mbox{\hyperlink{me_8h_a98ccdf2ca1cea60aacd4b0029eff4d5a}{PDEFERRED\_ROUTINE}}\ DeferredRoutine;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00259}00259\ \ \ \ \ \textcolor{keywordtype}{void}*\ DeferredContext;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00260}00260\ \ \ \ \ \textcolor{keywordtype}{void}*\ SystemArgument1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00261}00261\ \ \ \ \ \textcolor{keywordtype}{void}*\ SystemArgument2;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00262}00262\ \ \ \ \ uintptr\_t\ TimerHand;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00263}00263\ \ \ \ \ \mbox{\hyperlink{core_8h_a70c4f07737f0f901b6b34b4655c9ee42}{PPROCESSOR}}\ Cpu\ =\ \mbox{\hyperlink{me_8h_ad67c53006a896cba38c6eabe92a0ad91}{MeGetCurrentProcessor}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00264}00264\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00265}00265\ \ \ \ \ DpcData\ =\ \&Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a8c3412414cd69fe255159c3ad61e6580}{DpcData}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00266}00266\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00267}00267\ \ \ \ \ \textcolor{comment}{//\ Outer\ Loop:\ Process\ until\ queue\ is\ empty}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00268}00268\ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00269}00269\ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a6bfb22756c90a50ccc04b2a86c40cfa7}{DpcRoutineActive}}\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00270}00270\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00271}00271\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ Timer\ Expiration\ -\/-\/\ Unused\ for\ now,\ until\ we\ introduce\ MsWaitForSingleObject\ (will\ replace\ MsWaitForEvent\ n\ stuff),\ and\ also\ MeDelayExecutionThread}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00272}00272\ \ \ \ \ \ \ \ \ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00273}00273\ \textcolor{comment}{\ \ \ \ \ \ \ \ if\ (Cpu-\/>TimerRequest\ !=\ 0)\ \{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00274}00274\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ TimerHand\ =\ Cpu-\/>TimerHand;}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00275}00275\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ Cpu-\/>TimerRequest\ =\ 0;}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00276}00276\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00277}00277\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \_\_sti();\ //\ Enable\ interrupts\ for\ timer\ processing}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00278}00278\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ MeTimerExpiration(TimerHand);}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00279}00279\ \textcolor{comment}{\ \ \ \ \ \ \ \ \ \ \ \ \_\_cli();\ //\ Disable\ again}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00280}00280\ \textcolor{comment}{\ \ \ \ \ \ \ \ \}}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00281}00281\ \textcolor{comment}{\ \ \ \ \ \ \ \ */}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00282}00282\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{intrin_8h_a7b1a47a94be3cc9455621cecad58b168}{UNREFERENCED\_PARAMETER}}(TimerHand);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00283}00283\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00284}00284\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Process\ DPC\ Queue}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00285}00285\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ !=\ 0)\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00286}00286\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00287}00287\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inner\ Loop:\ Pop\ one,\ run\ one}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00288}00288\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{do}\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00289}00289\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Lock}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00290}00290\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{spinlock_8c_ad126d8031fb952a65a0fc565304cdc66}{MsAcquireSpinlockAtDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00291}00291\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00292}00292\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Entry\ =\ DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a9a558fad628e89bac3eebc7e8f22e979}{DpcListHead}}.\mbox{\hyperlink{struct___d_o_u_b_l_y___l_i_n_k_e_d___l_i_s_t_ad730634dba2dfcaef8cb8880cb1e4719}{Flink}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00293}00293\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00294}00294\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Entry\ !=\ \&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a9a558fad628e89bac3eebc7e8f22e979}{DpcListHead}})\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00295}00295\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Remove\ from\ List}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00296}00296\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{ms_8h_aebca627613f330873979f93e89dff9d1}{RemoveEntryList}}(Entry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00297}00297\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Dpc\ =\ \mbox{\hyperlink{macros_8h_aad0775b806dea2a5529806f0e8d90cee}{CONTAINING\_RECORD}}(Entry,\ \mbox{\hyperlink{me_8h_ab4a5c3c2096f05e5f0db35f80685b4a2}{DPC}},\ DpcListEntry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00298}00298\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Capture\ Context}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00299}00299\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DeferredRoutine\ =\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_ac9db2f3a658e6e02224ab39a4d760dad}{DeferredRoutine}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00300}00300\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DeferredContext\ =\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a6413de703eddd00e21b444198634e929}{DeferredContext}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00301}00301\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SystemArgument1\ =\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a4688332bb1389fa4fc54dec4f9dc8191}{SystemArgument1}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00302}00302\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ SystemArgument2\ =\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a94cb16dc910c8ea0723bda85c9ade63e}{SystemArgument2}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00303}00303\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00304}00304\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Changes\ must\ be\ set\ before\ others\ can\ modify.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00305}00305\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{mm_8h_a69a25077688e3321b41c64ece6626df7}{MmFullBarrier}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00306}00306\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00307}00307\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Clear\ DpcData\ so\ it\ can\ be\ re-\/queued\ inside\ its\ own\ routine}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00308}00308\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a52ba91d1594b7e70a0cd06501bc51eae}{DpcData}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00309}00309\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ -\/=\ 1;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00310}00310\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00311}00311\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Release\ Lock}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00312}00312\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{spinlock_8c_abf7cfc98a356c8cf7f1d20e233a77cc3}{MsReleaseSpinlockFromDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00313}00313\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00314}00314\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Enable\ Interrupts\ for\ execution}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00315}00315\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{intrin_8h_a75ba81f3504f770413771043ac0e7c05}{\_\_sti}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00316}00316\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00317}00317\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Execute}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00318}00318\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a0831e8262ba92e5998b1bec18f5f31e3}{CurrentDeferredRoutine}}\ =\ Dpc;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00319}00319\ \textcolor{preprocessor}{\#ifdef\ DEBUG}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00320}00320\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{gop_8c_a41ff1165c1969706dadb5b409ae082e9}{gop\_printf}}(\mbox{\hyperlink{mg_8h_a9b44987ffdc2af19b635206b94334b69}{COLOR\_WHITE}},\ \textcolor{stringliteral}{"{}I'm\ about\ to\ execute\ DPC\ \%p\ |\ Routine:\ \%p\ |\ SysArg1:\ \%p\ |\ SysArg2:\ \%p\ |\ Priority:\ \%d\(\backslash\)n"{}},\ Dpc,\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_ac9db2f3a658e6e02224ab39a4d760dad}{DeferredRoutine}},\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a4688332bb1389fa4fc54dec4f9dc8191}{SystemArgument1}},\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_a94cb16dc910c8ea0723bda85c9ade63e}{SystemArgument2}},\ Dpc-\/>\mbox{\hyperlink{struct___d_p_c_abce9ebc8b8ce23879e74470215afb66c}{priority}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00321}00321\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00322}00322\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ DeferredRoutine(Dpc,\ DeferredContext,\ SystemArgument1,\ SystemArgument2);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00323}00323\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a0831e8262ba92e5998b1bec18f5f31e3}{CurrentDeferredRoutine}}\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00324}00324\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00325}00325\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Assertion,\ incase\ the\ DPC\ changed\ the\ IRQL\ level.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00326}00326\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{assert_8h_a3d4ae9c092e117c836f52dc7d7cee574}{assert}}(\mbox{\hyperlink{me_8h_a6abf254a525b635b6dc210cd370536d1}{MeGetCurrentIrql}}()\ ==\ \mbox{\hyperlink{core_8h_a6ff101fd8adf1c79792d98893f8dee3ea291292740ec80ec0ff8e2a70c5bdfd6f}{DISPATCH\_LEVEL}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00327}00327\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00328}00328\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Disable\ Interrupts\ for\ next\ loop\ iteration}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00329}00329\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{intrin_8h_abb1251f925e2791c9288b7e32dd3e631}{\_\_cli}}();}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00330}00330\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00331}00331\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00332}00332\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00333}00333\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ List\ was\ empty}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00334}00334\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{spinlock_8c_abf7cfc98a356c8cf7f1d20e233a77cc3}{MsReleaseSpinlockFromDpcLevel}}(\&DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a3c9dfb5cbfce037aec715815583f1d5e}{DpcLock}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00335}00335\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00336}00336\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00337}00337\ \ \ \ \ \ \ \ \ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ !=\ 0);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00338}00338\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00339}00339\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00340}00340\ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a6bfb22756c90a50ccc04b2a86c40cfa7}{DpcRoutineActive}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00341}00341\ \ \ \ \ \ \ \ \ Cpu-\/>\mbox{\hyperlink{struct___p_r_o_c_e_s_s_o_r_a87c88a9cc221f31eb87ded1defa416e5}{DpcInterruptRequested}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00342}00342\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00343}00343\ \ \ \ \ \}\ \textcolor{keywordflow}{while}\ (DpcData-\/>\mbox{\hyperlink{struct___d_p_c___d_a_t_a_a2922522d513aed842b6032c60a85d4a8}{DpcQueueDepth}}\ !=\ 0);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00344}00344\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00345}00345\ \ \ \ \ \textcolor{comment}{//\ Return\ statement,\ assert\ that\ interrupts\ are\ disabled.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00346}00346\ \ \ \ \ \mbox{\hyperlink{assert_8h_a3d4ae9c092e117c836f52dc7d7cee574}{assert}}(\mbox{\hyperlink{irql_8c_a554f81fa12d240c84d378dae18ae4da6}{MeAreInterruptsEnabled}}()\ ==\ \textcolor{keyword}{false},\ \textcolor{stringliteral}{"{}Interrupts\ must\ not\ enabled\ at\ DPC\ Retirement\ exit"{}});}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00347}00347\ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00348}00348\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00349}00349\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00350}\mbox{\hyperlink{dpc_8c_ab5394f0b02b05dc6fc0a3fe668b603d8}{00350}}\ \mbox{\hyperlink{dpc_8c_ab5394f0b02b05dc6fc0a3fe668b603d8}{MeSetTargetProcessorDpc}}(}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00351}00351\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_af17808df1561cc593973d56446dfa44f}{PDPC}}\ Dpc,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00352}00352\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ uint32\_t\ CpuNumber}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00353}00353\ )}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00354}00354\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00355}00355\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00356}00356\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00357}00357\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00358}00358\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00359}00359\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ ensures\ that\ the\ DPC\ executes\ only\ on\ the\ CPU}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00360}00360\ \textcolor{comment}{\ \ \ \ \ \ \ \ corresponding\ to\ the\ supplied\ LAPIC\ ID.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00361}00361\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00362}00362\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00363}00363\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00364}00364\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ PDPC\ DpcAllocated\ -\/\ Pointer\ to\ DPC\ allocated\ in\ resident\ memory\ (e.g,\ pool\ alloc)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00365}00365\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ uint32\_t\ CpuNumber\ -\/\ LAPIC\ ID\ Of\ the\ certain\ CPU\ Core\ to\ be\ ran\ on.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00366}00366\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00367}00367\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00368}00368\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00369}00369\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00370}00370\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00371}00371\ \textcolor{comment}{\ \ \ \ Notes:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00372}00372\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00373}00373\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ call\ must\ be\ made\ before\ MeInsertQueueDpc.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00374}00374\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00375}00375\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00376}00376\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00377}00377\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00378}00378\ \ \ \ \ \mbox{\hyperlink{assert_8h_a3d4ae9c092e117c836f52dc7d7cee574}{assert}}(CpuNumber\ <\ \mbox{\hyperlink{me_8h_abc4a08b1fe59de8b6712442b8b3f08e2}{MeGetActiveProcessorCount}}());}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00379}00379\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00380}00380\ \ \ \ \ Dpc-\/>CpuNumber\ =\ CpuNumber;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00381}00381\ \}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00382}00382\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00383}00383\ \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00384}\mbox{\hyperlink{dpc_8c_a9f616b46e03e4d75165b5e334582fe2f}{00384}}\ \mbox{\hyperlink{dpc_8c_a9f616b46e03e4d75165b5e334582fe2f}{MeInitializeDpc}}(}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00385}00385\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_af17808df1561cc593973d56446dfa44f}{PDPC}}\ DpcAllocated,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00386}00386\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_a98ccdf2ca1cea60aacd4b0029eff4d5a}{PDEFERRED\_ROUTINE}}\ DeferredRoutine,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00387}00387\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \textcolor{keywordtype}{void}*\ DeferredContext,}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00388}00388\ \ \ \ \ \mbox{\hyperlink{annotations_8h_ac2bbd6d630a06a980d9a92ddb9a49928}{IN}}\ \mbox{\hyperlink{me_8h_a7f413397165967ca4cdadfb6310158be}{DPC\_PRIORITY}}\ DeferredPriority}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00389}00389\ )}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00390}00390\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00391}00391\ \textcolor{comment}{/*++}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00392}00392\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00393}00393\ \textcolor{comment}{\ \ \ \ Routine\ description:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00394}00394\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00395}00395\ \textcolor{comment}{\ \ \ \ \ \ \ \ This\ function\ initializes\ a\ DPC\ to\ be\ used\ for\ queueing.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00396}00396\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00397}00397\ \textcolor{comment}{\ \ \ \ Arguments:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00398}00398\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00399}00399\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ PDPC\ DpcAllocated\ -\/\ Pointer\ to\ DPC\ allocated\ in\ resident\ memory\ (e.g,\ pool\ alloc)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00400}00400\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ PDEFERRED\_ROUTINE\ DeferredRoutine\ -\/\ Pointer\ to\ deferred\ routine\ for\ the\ DPC\ to\ execute.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00401}00401\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ void*\ DeferredContext\ -\/\ Opaque\ pointer\ to\ deferred\ context,\ passed\ to\ the\ DeferredRoutine\ function\ as\ a\ parameter.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00402}00402\ \textcolor{comment}{\ \ \ \ \ \ \ \ [IN]\ DPC\_PRIORITY\ DeferredPriority\ -\/\ Supplies\ the\ priority\ of\ the\ DPC.\ A\ DPC\ of\ LOW\_PRIORITY\ will\ not\ be\ executed\ at\ queue\ time\ unless\ the\ depth\ is\ full,\ or\ a\ software\ interrupt\ occurs.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00403}00403\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00404}00404\ \textcolor{comment}{\ \ \ \ Return\ Values:}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00405}00405\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00406}00406\ \textcolor{comment}{\ \ \ \ \ \ \ \ None.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00407}00407\ \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00408}00408\ \textcolor{comment}{-\/-\/*/}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00409}00409\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00410}00410\ \{}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00411}00411\ \ \ \ \ \textcolor{comment}{//\ Initialize\ standard\ DPC\ headers.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00412}00412\ \ \ \ \ DpcAllocated-\/>priority\ =\ DeferredPriority;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00413}00413\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00414}00414\ \ \ \ \ \textcolor{comment}{//\ Initialize\ address\ of\ routine\ and\ context\ param.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00415}00415\ \ \ \ \ DpcAllocated-\/>DeferredRoutine\ =\ DeferredRoutine;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00416}00416\ \ \ \ \ DpcAllocated-\/>DeferredContext\ =\ DeferredContext;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00417}00417\ \ \ \ \ DpcAllocated-\/>DpcData\ =\ NULL;}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00418}00418\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00419}00419\ \ \ \ \ \textcolor{comment}{//\ Set\ to\ current\ CPU.\ (the\ driver\ can\ modify\ his\ CPU)}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00420}00420\ \ \ \ \ DpcAllocated-\/>CpuNumber\ =\ \mbox{\hyperlink{me_8h_ae30deea151b97a78a128f1cd6a1eb2b7}{DPC\_TARGET\_CURRENT}};}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00421}00421\ }
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00422}00422\ \ \ \ \ \textcolor{comment}{//\ Initialize\ list\ head\ for\ DPC.}}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00423}00423\ \ \ \ \ \mbox{\hyperlink{ms_8h_a46e3ce34dec4da38189211cef81110c1}{InitializeListHead}}(\&DpcAllocated-\/>DpcListEntry);}
\DoxyCodeLine{\Hypertarget{dpc_8c_source_l00424}00424\ \}}

\end{DoxyCode}
