\doxysection{C\+:/\+Users/matanel/\+Desktop/\+Projects/\+Kernel\+Development/kernel/memory/memory.c File Reference}
\hypertarget{memory_8c}{}\label{memory_8c}\index{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/memory/memory.c@{C:/Users/matanel/Desktop/Projects/KernelDevelopment/kernel/memory/memory.c}}
{\ttfamily \#include "{}memory.\+h"{}}\newline
{\ttfamily \#include "{}../drivers/gop/gop.\+h"{}}\newline
{\ttfamily \#include "{}../bugcheck/bugcheck.\+h"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{memory_8c_aa1c249f197a325121cc9678b1665c29b}{zero\+\_\+bss}} (void)
\begin{DoxyCompactList}\small\item\em Zeroes out the BSS section (garbage data that might have left there) \end{DoxyCompactList}\item 
void \mbox{\hyperlink{memory_8c_ae9571189e4229763c03dbf08f551f33f}{init\+\_\+heap}} (void)
\begin{DoxyCompactList}\small\item\em Initializes the Kernel\textquotesingle{}s HEAP for dynamic memory allocation. \end{DoxyCompactList}\item 
void \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{memory_8c_aa3e72f75500f5ac381dd21e9510e75c4}{kmemset}} (void \texorpdfstring{$\ast$}{*}dest, int64\+\_\+t val, uint64\+\_\+t len)
\item 
void \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{memory_8c_ab39f87327d3ce3e35d369e4e9f7a4c69}{kmemcpy}} (void \texorpdfstring{$\ast$}{*}dest, const void \texorpdfstring{$\ast$}{*}src, uint32\+\_\+t len)
\item 
void \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{memory_8c_a75f54e39669f1008f885acebe11d6e37}{Mt\+Allocate\+Virtual\+Memory}} (size\+\_\+t wanted\+\_\+size, size\+\_\+t align)
\begin{DoxyCompactList}\small\item\em Allocate {\ttfamily wanted\+\_\+size} bytes with {\ttfamily align} alignment. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{memory_8c_a8e94e4cf36924a0d2f3d86a3c77fb252}{Mt\+Is\+Heap\+Address\+Allocated}} (void \texorpdfstring{$\ast$}{*}ptr)
\begin{DoxyCompactList}\small\item\em Returns if the heap pointer given has been allocated by Mt\+Allocate\+Virtual\+Memory or not. \end{DoxyCompactList}\item 
void \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{memory_8c_a112be63200d2c946ececbc78eeaed3dc}{Mt\+Allocate\+Virtual\+Memory\+Ex}} (size\+\_\+t wanted\+\_\+size, size\+\_\+t align, uint64\+\_\+t flags)
\begin{DoxyCompactList}\small\item\em {\bfseries{THE USE OF THIS FUNCTION IS NOT RECOMMENDED -- TO ADD \doxylink{paging_8h_af7dfc03bd87d1aaf678c1a4ec7435763}{FLAGS} TO AN ALLOCATED MEMORY BUFFER USE Mt\+Add\+Page\+Flags TO ITS POINTER!!!}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} FREEING THE MEMORY OF THIS BUFFER WILL RESULT IN A PAGE FAULT \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} Allocates a block of memory from the kernel\textquotesingle{}s memory manager, and sets the paging flags according to the user. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{memory_8c_af1b9597857f95921e2e2dc63e84394fa}{Mt\+Free\+Virtual\+Memory}} (void \texorpdfstring{$\ast$}{*}ptr)
\begin{DoxyCompactList}\small\item\em Releases (frees) a previously allocated block of memory back to the kernel’s memory manager. (DOES NOT UNMAP IF FUNCTION USED IS Mt\+Allocate\+Virtual\+Memory !) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{uefi__memory_8h_a76f436ea56fd593cab07a6800d630828}{GOP\+\_\+\+PARAMS}} \mbox{\hyperlink{memory_8c_ad8ca0be32b831aec9de80bcf0e22107e}{gop\+\_\+local}}
\item 
uintptr\+\_\+t \mbox{\hyperlink{memory_8c_aa9c2521d6762a016314d8b4397a712c4}{heap\+\_\+current\+\_\+end}}
\end{DoxyCompactItemize}


\label{doc-func-members}
\Hypertarget{memory_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{memory_8c_ae9571189e4229763c03dbf08f551f33f}\index{memory.c@{memory.c}!init\_heap@{init\_heap}}
\index{init\_heap@{init\_heap}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{init\_heap()}{init\_heap()}}
{\footnotesize\ttfamily \label{memory_8c_ae9571189e4229763c03dbf08f551f33f} 
void init\+\_\+heap (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Initializes the Kernel\textquotesingle{}s HEAP for dynamic memory allocation. 

The function declares the globals for the heap current end, as well as setting up the free\+\_\+list pointer. It first creates 1 initial 4KiB frame, maps it to be paged in virtual memory, and increases the heap current end by the frame size (4KiB), so that 1 starting page is allocated. 

Definition at line \mbox{\hyperlink{memory_8c_source_l00036}{36}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_ab39f87327d3ce3e35d369e4e9f7a4c69}\index{memory.c@{memory.c}!kmemcpy@{kmemcpy}}
\index{kmemcpy@{kmemcpy}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{kmemcpy()}{kmemcpy()}}
{\footnotesize\ttfamily \label{memory_8c_ab39f87327d3ce3e35d369e4e9f7a4c69} 
void \texorpdfstring{$\ast$}{*} kmemcpy (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{dest}{, }\item[{const void \texorpdfstring{$\ast$}{*}}]{src}{, }\item[{uint32\+\_\+t}]{len}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{memory_8c_source_l00138}{138}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_aa3e72f75500f5ac381dd21e9510e75c4}\index{memory.c@{memory.c}!kmemset@{kmemset}}
\index{kmemset@{kmemset}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{kmemset()}{kmemset()}}
{\footnotesize\ttfamily \label{memory_8c_aa3e72f75500f5ac381dd21e9510e75c4} 
void \texorpdfstring{$\ast$}{*} kmemset (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{dest}{, }\item[{int64\+\_\+t}]{val}{, }\item[{uint64\+\_\+t}]{len}{}\end{DoxyParamCaption})}



Definition at line \mbox{\hyperlink{memory_8c_source_l00125}{125}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_a75f54e39669f1008f885acebe11d6e37}\index{memory.c@{memory.c}!MtAllocateVirtualMemory@{MtAllocateVirtualMemory}}
\index{MtAllocateVirtualMemory@{MtAllocateVirtualMemory}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{MtAllocateVirtualMemory()}{MtAllocateVirtualMemory()}}
{\footnotesize\ttfamily \label{memory_8c_a75f54e39669f1008f885acebe11d6e37} 
void \texorpdfstring{$\ast$}{*} Mt\+Allocate\+Virtual\+Memory (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{wanted\+\_\+size}{, }\item[{size\+\_\+t}]{align}{}\end{DoxyParamCaption})}



Allocate {\ttfamily wanted\+\_\+size} bytes with {\ttfamily align} alignment. 

Allocates a block of memory from the kernel’s memory manager. Zero the new memory block out.

Definition at line \mbox{\hyperlink{memory_8c_source_l00154}{154}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_a112be63200d2c946ececbc78eeaed3dc}\index{memory.c@{memory.c}!MtAllocateVirtualMemoryEx@{MtAllocateVirtualMemoryEx}}
\index{MtAllocateVirtualMemoryEx@{MtAllocateVirtualMemoryEx}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{MtAllocateVirtualMemoryEx()}{MtAllocateVirtualMemoryEx()}}
{\footnotesize\ttfamily \label{memory_8c_a112be63200d2c946ececbc78eeaed3dc} 
void \texorpdfstring{$\ast$}{*} Mt\+Allocate\+Virtual\+Memory\+Ex (\begin{DoxyParamCaption}\item[{size\+\_\+t}]{size}{, }\item[{size\+\_\+t}]{align}{, }\item[{uint64\+\_\+t}]{flags}{}\end{DoxyParamCaption})}



{\bfseries{THE USE OF THIS FUNCTION IS NOT RECOMMENDED -- TO ADD \doxylink{paging_8h_af7dfc03bd87d1aaf678c1a4ec7435763}{FLAGS} TO AN ALLOCATED MEMORY BUFFER USE Mt\+Add\+Page\+Flags TO ITS POINTER!!!}} \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} FREEING THE MEMORY OF THIS BUFFER WILL RESULT IN A PAGE FAULT \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*} Allocates a block of memory from the kernel\textquotesingle{}s memory manager, and sets the paging flags according to the user. 


\begin{DoxyParams}{Parameters}
{\em size} & Size in bytes to allocate\\
\hline
{\em align} & Alignment for each byteblock (use internal structs for process \textbackslash{} other -\/ use \+\_\+\+Alignof)\\
\hline
{\em flags} & PAGE\+\_\+\+FLAGS flags.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to start of allocated memory
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{memory_8c_source_l00227}{227}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_af1b9597857f95921e2e2dc63e84394fa}\index{memory.c@{memory.c}!MtFreeVirtualMemory@{MtFreeVirtualMemory}}
\index{MtFreeVirtualMemory@{MtFreeVirtualMemory}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{MtFreeVirtualMemory()}{MtFreeVirtualMemory()}}
{\footnotesize\ttfamily \label{memory_8c_af1b9597857f95921e2e2dc63e84394fa} 
void Mt\+Free\+Virtual\+Memory (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{ptr}{}\end{DoxyParamCaption})}



Releases (frees) a previously allocated block of memory back to the kernel’s memory manager. (DOES NOT UNMAP IF FUNCTION USED IS Mt\+Allocate\+Virtual\+Memory !) 


\begin{DoxyParams}{Parameters}
{\em ptr} & Pointer to the allocated memory block to free\\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{memory_8c_source_l00276}{276}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_a8e94e4cf36924a0d2f3d86a3c77fb252}\index{memory.c@{memory.c}!MtIsHeapAddressAllocated@{MtIsHeapAddressAllocated}}
\index{MtIsHeapAddressAllocated@{MtIsHeapAddressAllocated}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{MtIsHeapAddressAllocated()}{MtIsHeapAddressAllocated()}}
{\footnotesize\ttfamily \label{memory_8c_a8e94e4cf36924a0d2f3d86a3c77fb252} 
bool Mt\+Is\+Heap\+Address\+Allocated (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{ptr}{}\end{DoxyParamCaption})}



Returns if the heap pointer given has been allocated by Mt\+Allocate\+Virtual\+Memory or not. 


\begin{DoxyParams}{Parameters}
{\em ptr} & Address of what is given from Mt\+Allocate\+Virtual\+Memory.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}

\end{DoxyReturn}


Definition at line \mbox{\hyperlink{memory_8c_source_l00220}{220}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

\Hypertarget{memory_8c_aa1c249f197a325121cc9678b1665c29b}\index{memory.c@{memory.c}!zero\_bss@{zero\_bss}}
\index{zero\_bss@{zero\_bss}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{zero\_bss()}{zero\_bss()}}
{\footnotesize\ttfamily \label{memory_8c_aa1c249f197a325121cc9678b1665c29b} 
void zero\+\_\+bss (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Zeroes out the BSS section (garbage data that might have left there) 

The function takes the start and end address of the {\ttfamily .bss} section (provided by the linker script), and iterates over each byte from the start address up to (but not including) the end address, writing zero to each location. This ensures all global/static variables without initializers are zeroed. 

Definition at line \mbox{\hyperlink{memory_8c_source_l00023}{23}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.



\label{doc-var-members}
\Hypertarget{memory_8c_doc-var-members}
\doxysubsection{Variable Documentation}
\Hypertarget{memory_8c_ad8ca0be32b831aec9de80bcf0e22107e}\index{memory.c@{memory.c}!gop\_local@{gop\_local}}
\index{gop\_local@{gop\_local}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{gop\_local}{gop\_local}}
{\footnotesize\ttfamily \label{memory_8c_ad8ca0be32b831aec9de80bcf0e22107e} 
\mbox{\hyperlink{uefi__memory_8h_a76f436ea56fd593cab07a6800d630828}{GOP\+\_\+\+PARAMS}} gop\+\_\+local\hspace{0.3cm}{\ttfamily [extern]}}



Definition at line \mbox{\hyperlink{kernel_8c_source_l00015}{15}} of file \mbox{\hyperlink{kernel_8c_source}{kernel.\+c}}.

\Hypertarget{memory_8c_aa9c2521d6762a016314d8b4397a712c4}\index{memory.c@{memory.c}!heap\_current\_end@{heap\_current\_end}}
\index{heap\_current\_end@{heap\_current\_end}!memory.c@{memory.c}}
\doxysubsubsection{\texorpdfstring{heap\_current\_end}{heap\_current\_end}}
{\footnotesize\ttfamily \label{memory_8c_aa9c2521d6762a016314d8b4397a712c4} 
uintptr\+\_\+t heap\+\_\+current\+\_\+end}



Definition at line \mbox{\hyperlink{memory_8c_source_l00013}{13}} of file \mbox{\hyperlink{memory_8c_source}{memory.\+c}}.

